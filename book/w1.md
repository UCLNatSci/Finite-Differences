# Introduction to finite differences

## Refresher on Taylor series
Feel free to skip this section if you feel comfortable with these concepts.

```{admonition} Big idea : Local approximation of a function
We can compute a series expansion for a function in powers of $x$ using Taylor series. The resulting truncated polynomial gives a good local approximation to a function in a sense made precise by the Lagrange remainder theorem. If the truncated polynomial is used near the expansion point $$a$$ then its accuracy "goes like" the $n^{\text{th}}$ power of the distance from $a$.
```
   
### Taylor expansion definition
We will write the formula for expansion about $x=a$, in which we seek to express $f(x)$ as an infinite polynomial of the form

$\begin{equation} p(x;a)=\sum_{j=0}^{\infty}c_n(x-a)^n = c_0 +c_1(x-a)+c_2(x-a)^2+\dots +c_n(c-a)^n+\dots\end{equation}$

We choose the coefficients $c_n$ to ensure that the $n^{\text{th}}$ derivative of the polynomial is equal to the $n^{\text{th}}$ derivative of the function at the point $x=a$. In this sense, the Taylor series gives the best possible local polynomial approximation to $f(x)$ of specified degree. By repeatedly differentiating and evaluating the polynomial, we obtain $\begin{equation}c_n=\frac{f^{(n)}(a)}{n!}\end{equation}$ <br>
This result defines the Taylor series for $$f(x)$$, given in the box below.

```{admonition} Taylor series for $f(x)$ about a point $x=a$.

$\begin{equation}p(x;a) = \sum_{n=0}^{\infty}\frac{f^{(n)}(a)}{n!}(x-a)^n\end{equation}$

The special case when $a=0$ is known as the Maclaurin series for historical reasons.
```


**A disclaimer!**

Not all functions are faithfully represented by their Taylor Series. We have only guaranteed that the polynomial has the "correct" behaviour in the immediate vicinity of the point $x=a$. Two things should be checked:

1. Does the series converge to a finite value for all $x$? <br>
We can find the radius of convergence by using the ratio test
1. Does it converge to $f(x)$? <br>
We must show that $\displaystyle \lim_{k\rightarrow \infty}|f(x)-p_k(x;a)|=0$, which may only be true for some values of $x$.
This can be done by making use of the Lagrange remainder theorem, introduced in the next subsection.

Functions which converge to their Taylor series are called analytic, and functions which converge to their Taylor series everywhere are called entire. The sine and cosine series, and the $e^x$ series are entire. The Maclaurin series for $\ln(1+x)$ is analytic for $|x|<1$.


### Practical use
The Taylor series nearly always contains an infinite number of terms. To be of practical use in numeric applications, we need to "truncate" the expansion, meaning that we retain only the terms up to a specified $n^{\text{th}}$ power of $x$. As well as considering the validity of the infinite series, it is important to be able to determine how many terms in the series are needed for practical use. If the series converges very slowly, then it may not be much good!

The Lagrange remainder theorem, given in the box below, allows us to place precise bounds on the size of the error. The result shows that the error in the truncated expansion is proportional to the next power of $(x-a)$.

```{admonition} Lagrange remainder theorem

Let $p_n(x;a)$ be the truncated Taylor expansion of $f(x)$ about point $x=a$, up to and including the term in $(x-a)^n$.

The remainder (error) in the truncated expansion is given by:

$\begin{equation}R_n(x) = \biggr|f(x)-p_n(x;a)\biggr| = \biggr|\frac{f^{n+1}(\xi)(x-a)^{n+1}}{(n+1)!}\biggr|, \qquad \xi\in(a,x)\end{equation}$
```

We say that the degree $n$ series has "order $(x-a)^n$ accuracy", and we may write

$\begin{equation}f(x)=p_n(x;a)+\mathcal{O}((x-a)^{n+1})\end{equation}$

where the big-O notation describes the order of the error terms.

The power-relationship in Lagrange's theorem can be anticipated when $(x-a)$ is small, and for larger differences by noting that factorial growth (of the coefficient denominators) is much faster than algebraic (polynomial) growth. The proof, and derivation of the coefficient of $(x-a)^n$ is found by using the mean value theorem. It won't be of much benefit for our practical purposes to show the proof here, but I'm happy to provide it if you want to see it. Instead, let us take a look at an illustrative example.

   
#### Example

Use the Lagrange remainder theorem to compute an upper bound for the size of the error in the quadratic expansion of $\sin(x)$ about $x=\frac{\pi}{3}$, at a nearby point $x=\frac{\pi}{2}$.

   
#### Solution

The series expansion is found to be:

$\begin{equation}p_2(x;\pi/3)=\frac{\sqrt{3}}{2}+\frac{1}{2}\biggr(x-\frac{\pi}{3}\biggr)-\frac{\sqrt{3}}{4}\biggr(x-\frac{\pi}{3}\biggr)^2\end{equation}$

And from Lagrange's formula, the error in the expansion at $x=\frac{\pi}{2}$ is given by:

$\begin{equation}R(\xi)= \biggr|\frac{\cos(\xi)(\frac{\pi}{2}-\frac{\pi}{3})^3}{6}\biggr| \end{equation}$

Since $|\cos(\xi)|$ is bounded above by $1$ on the given domain, Lagrange's remainder theorem gives an upper bound of $\frac{\pi^3}{6^4}=0.0239246$

The exact error is 

$\begin{equation}\biggr|\sin\left(\frac{\pi}{2}\right)-p_2\left(\frac{\pi}{2};\frac{\pi}{3}\right)\biggr| = 0.0091119\end{equation}$


