
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>7. More problems &#8212; Finite Differences</title>
    
  <link href="../_static/css/theme.css" rel="stylesheet" />
  <link href="../_static/css/index.c5995385ac14fb8791e8eb36b4908be2.css" rel="stylesheet" />

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/sphinx-book-theme.e8e5499552300ddf5d7adccae7cc3b70.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/exercise.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystyle.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    <link rel="stylesheet" type="text/css" href="../_static/_static/mystyle.css" />
    
  <link rel="preload" as="script" href="../_static/js/index.1c5a1a01449ed65a7b51.js">

    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/togglebutton.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/sphinx-book-theme.12a9622fbb08dcb3a2a40b2c02b83a57.js"></script>
    <script async="async" src="https://unpkg.com/thebelab@latest/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["\\(", "\\)"]], "displayMath": [["\\[", "\\]"]], "processRefs": false, "processEnvironments": false}})</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="8. Higher order problems (examples)" href="higher-order.html" />
    <link rel="prev" title="6. Further problems" href="further_problems.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
      
      <h1 class="site-logo" id="site-title">Finite Differences</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../intro.html">
   Finite Differences
  </a>
 </li>
</ul>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="finite-intro.html">
   1. Basic concept
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="formulae.html">
   2. Additional formulae
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="implementation.html">
   3. Differentiation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="ivp.html">
   4. Initial value problem
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="multistage.html">
   5. Multi-stage methods
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="further_problems.html">
   6. Further problems
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   7. More problems
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="higher-order.html">
   8. Higher order problems (examples)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="w1_answers.html">
   9. Solutions to problems
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="boundary_conditions.html">
   10. Boundary conditions
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../_sources/finitediff/moreprobs.md"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.md</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/executablebooks/jupyter-book"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/executablebooks/jupyter-book/issues/new?title=Issue%20on%20page%20%2Ffinitediff/moreprobs.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        
    </div>
</div>

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#axially-symmetric-heat-flow">
   7.1. Axially symmetric heat flow
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#d-diffusion">
   7.2. 1D diffusion
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#d-wave-equation-with-cauchy-conditions">
   7.3. 1D wave equation with Cauchy conditions
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#solution">
     7.3.1. Solution
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#damped-1d-wave-equation">
   7.4. Damped 1D wave equation
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#d-heat-equation-with-dirichlet-conditions">
   7.5. 2D heat equation with Dirichlet conditions
  </a>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="more-problems">
<h1><span class="section-number">7. </span>More problems<a class="headerlink" href="#more-problems" title="Permalink to this headline">¶</a></h1>
<div class="section" id="axially-symmetric-heat-flow">
<h2><span class="section-number">7.1. </span>Axially symmetric heat flow<a class="headerlink" href="#axially-symmetric-heat-flow" title="Permalink to this headline">¶</a></h2>
<p>The image below shows a cross-section of pipe insulation, which is subjected to temperatures <span class="math notranslate nohighlight">\(\phi=500K\)</span> on the inner boundary and <span class="math notranslate nohighlight">\(\phi=300K\)</span> on the outer boundary. The radial and axial directions are denoted by <span class="math notranslate nohighlight">\(r,\theta\)</span>, respectively.</p>
<br>
<a class="reference internal image-reference" href="../_images/lagging.png"><img alt="secant" class="align-center" src="../_images/lagging.png" style="width: 400.0px; height: 328.0px;" /></a>
<br>
<p>Due to axial symmetry of the problem, the governing two-dimensional heat equation <span class="math notranslate nohighlight">\(\nabla^2\phi=0\)</span> for this problem can be reduced to</p>
<div class="math notranslate nohighlight" id="equation-heateqn">
<span class="eqno">(7.1)<a class="headerlink" href="#equation-heateqn" title="Permalink to this equation">¶</a></span>\[\frac{\partial^2\phi}{\partial r^2}+\frac{1}{r}\frac{\partial \phi}{\partial r}=0.\]</div>
<div class="exercise admonition" id="finitediff/moreprobs-exercise-0">
<p class="admonition-title"><span class="caption-number">Exercise 7.1 </span> </p>
<div class="section" id="exercise-content">
<p>Express equation <a class="reference internal" href="#equation-heateqn">(7.1)</a> in finite difference form, using a central difference scheme, and apply a Gauss-Seidel relaxation technique with 11 radial points to determine the solution <span class="math notranslate nohighlight">\(\phi(r)\)</span> for <span class="math notranslate nohighlight">\(r\in[0.05,0.10]\)</span> to within <span class="math notranslate nohighlight">\(10^{-4}\)</span>.</p>
<p>Graphically compare your answer to the analytic solution, which is given by</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{equation*}\phi = 200\frac{\ln(0.10)-\ln(r)}{\ln(2)} +300.\end{equation*}\]</div>
</div>
</div>
<p><strong>Solution</strong>
The equation can be written out using the central differences formula as:</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{equation*}
\frac{\phi_{i-1}-2\phi_i+\phi_{i+1}}{h^2}+\frac{1}{r_i}\frac{\phi_{i+1}-\phi_{i-1}}{2h}=0
\end{equation*}\]</div>
<p>which rearranges to</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{equation*}
\phi_i=\frac{\left(r_i-\frac{h}{2}\right)\phi_{i-1}+\left(r_i+\frac{h}{2}\right)\phi_{i+1}}{2r_i}
\end{equation*}\]</div>
<p>This can be applied as follows</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">n</span><span class="o">=</span><span class="mi">11</span><span class="p">;</span>                                      <span class="o">%</span> <span class="n">We</span> <span class="n">are</span> <span class="n">using</span> <span class="mi">11</span> <span class="n">points</span>
<span class="n">r</span> <span class="o">=</span> <span class="n">linspace</span><span class="p">(</span><span class="mf">0.05</span><span class="p">,</span><span class="mf">0.10</span><span class="p">,</span><span class="n">n</span><span class="p">);</span> <span class="n">h</span> <span class="o">=</span><span class="n">r</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">-</span><span class="n">r</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>   <span class="o">%</span> <span class="n">Construct</span> <span class="n">the</span> <span class="n">radial</span> <span class="n">coordinate</span>

<span class="o">%</span><span class="n">Set</span> <span class="n">up</span> <span class="n">the</span> <span class="n">initial</span> <span class="n">grid</span> <span class="p">:</span>
<span class="n">F</span> <span class="o">=</span> <span class="mi">400</span><span class="o">*</span><span class="n">ones</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">n</span><span class="p">);</span>      <span class="o">%</span> <span class="n">The</span> <span class="n">temperature</span> <span class="n">average</span> <span class="ow">is</span> <span class="n">a</span> <span class="n">suitable</span> <span class="n">choice</span>
<span class="n">F</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">=</span><span class="mi">500</span><span class="p">;</span><span class="n">F</span><span class="p">(</span><span class="n">end</span><span class="p">)</span><span class="o">=</span><span class="mi">300</span><span class="p">;</span>    <span class="o">%</span> <span class="n">Enforce</span> <span class="n">boundary</span> <span class="n">conditions</span>

<span class="k">for</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">1</span><span class="p">:</span><span class="mi">200</span>    <span class="o">%</span><span class="n">Limit</span> <span class="n">to</span> <span class="mi">200</span> <span class="n">iterations</span>
    <span class="n">Fcheck</span> <span class="o">=</span> <span class="n">F</span><span class="p">;</span>  <span class="o">%</span><span class="n">To</span> <span class="n">check</span> <span class="k">for</span> <span class="n">convergence</span>
    <span class="k">for</span> <span class="n">k</span><span class="o">=</span><span class="mi">2</span><span class="p">:</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span>  <span class="o">%</span><span class="n">On</span> <span class="n">interior</span> <span class="n">points</span>
        <span class="n">F</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="p">((</span><span class="n">r</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="o">-</span><span class="n">h</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">F</span><span class="p">(</span><span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="n">r</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="o">+</span><span class="n">h</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">F</span><span class="p">(</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span><span class="o">/</span><span class="mi">2</span><span class="o">/</span><span class="n">r</span><span class="p">(</span><span class="n">k</span><span class="p">);</span>
    <span class="n">end</span>
    <span class="k">if</span> <span class="n">norm</span><span class="p">(</span><span class="n">Fcheck</span><span class="o">-</span><span class="n">F</span><span class="p">)</span><span class="o">&lt;</span><span class="mi">10</span><span class="o">^-</span><span class="mi">4</span>
        <span class="n">fprintf</span><span class="p">(</span><span class="s1">&#39;Converged after </span><span class="si">%d</span><span class="s1"> iterations,&#39;</span><span class="p">,</span><span class="n">j</span><span class="p">)</span>
        <span class="k">break</span>
    <span class="n">end</span>
<span class="n">end</span>
</pre></div>
</div>
<p>In this case we are able to compare to the analytic solution obtained by integrating the ODE by hand:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">figure</span>
<span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span><span class="n">plot</span><span class="p">(</span><span class="n">r</span><span class="p">,</span><span class="n">F</span><span class="p">);</span>
<span class="n">title</span><span class="p">(</span><span class="s1">&#39;estimated solution&#39;</span><span class="p">);</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">);</span><span class="n">xlim</span><span class="p">([</span><span class="mf">0.05</span><span class="p">,</span><span class="mf">0.1</span><span class="p">]);</span>
<span class="n">a</span><span class="o">=-</span><span class="mi">200</span><span class="o">/</span><span class="n">log</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span> <span class="n">b</span><span class="o">=</span><span class="mi">500</span><span class="o">-</span><span class="mi">200</span><span class="o">*</span><span class="n">log</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span><span class="o">/</span><span class="n">log</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
<span class="n">Fanalytic</span><span class="o">=</span> <span class="n">a</span><span class="o">*</span><span class="n">log</span><span class="p">(</span><span class="n">r</span><span class="p">)</span><span class="o">+</span><span class="n">b</span><span class="p">;</span>
<span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">);</span><span class="n">plot</span><span class="p">(</span><span class="n">r</span><span class="p">,</span><span class="nb">abs</span><span class="p">(</span><span class="n">F</span><span class="o">-</span><span class="n">Fanalytic</span><span class="p">))</span>
<span class="n">title</span><span class="p">(</span><span class="s1">&#39;error&#39;</span><span class="p">);</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">);</span><span class="n">xlim</span><span class="p">([</span><span class="mf">0.05</span><span class="p">,</span><span class="mf">0.1</span><span class="p">]);</span>
</pre></div>
</div>
</div>
<div class="section" id="d-diffusion">
<h2><span class="section-number">7.2. </span>1D diffusion<a class="headerlink" href="#d-diffusion" title="Permalink to this headline">¶</a></h2>
<p>Enceladus is a small, icy moon of Saturn, which has been observed to emit molecules of water from “cracks” in its surface. The following differential equation represents the competition between outward diffusion of water molecules from the surface and destruction due to ionization:</p>
<div class="math notranslate nohighlight">
\[	2r\frac{\partial c}{\partial r} + r^2\frac{\partial^2 c}{\partial r^2}=r^2 c \beta_{LOSS}.\]</div>
<p>In this equation, <span class="math notranslate nohighlight">\(r\)</span> is the radial distance from the centre of the moon, <span class="math notranslate nohighlight">\(c\)</span> is the steady state concentration of water molecules, and <span class="math notranslate nohighlight">\(\beta_{LOSS}\)</span> represents the relative importance of ionization compared to diffusion. We will take</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{equation*}
	\beta_{LOSS}=0.01, \qquad c(1)=1, \qquad c(50)=0.1,\qquad r\in[1,50].
\end{equation*}\]</div>
<ul class="simple">
<li><p>Write down  a discretised form of these equations, using a central difference scheme.</p></li>
<li><p>Solve the discretised system with 50 grid points simultaneously using a matrix method.</p></li>
<li><p>Solve the discretised system with 50 grid points using a Gauss-Seidel technique. Determine the number of iterations required for agreement with your part (2) solution to within <span class="math notranslate nohighlight">\(10^{-4}\)</span>.</p></li>
</ul>
<p><strong>Solution</strong></p>
<p><strong>Part 1: Discretisation</strong></p>
<div class="amsmath math notranslate nohighlight">
\[\begin{equation*}
2r_i\frac{c_{i+1}-c_{i-1}}{2\Delta r}+r_i^2\frac{c_{i+1}-2c_i+c_{i-1}}{\Delta r^2}=\beta_{LOSS} r_i^2 c_i
\end{equation*}\]</div>
<p>We can also eliminate a factor of <span class="math notranslate nohighlight">\(\frac{r_i}{\Delta r^2}\)</span> to give:</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{equation*}
(c_{i+1}-c_{i-1})\Delta r +r_i(c_{i+1}-2c_i+c_{i-1})=\beta_{LOSS}\Delta r^2 r_i c_i
\end{equation*}\]</div>
<p><strong>Part 2: Matrix method</strong></p>
<p>Grouping together terms gives (for example):</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{equation*}
(r_i-\Delta r)c_{i-1}-(2r_i+\beta_{LOSS}\Delta r^2 r_i)c_i +(r_i+\Delta r)c_{i+1}=0
\end{equation*}\]</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">n</span><span class="o">=</span><span class="mi">50</span><span class="p">;</span> <span class="n">bloss</span><span class="o">=</span><span class="mf">0.01</span><span class="p">;</span>   <span class="o">%</span> <span class="n">Values</span> <span class="n">defined</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">question</span>

<span class="n">r</span><span class="o">=</span><span class="n">linspace</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">50</span><span class="p">,</span><span class="n">n</span><span class="p">);</span> <span class="o">%</span> <span class="n">Set</span> <span class="n">up</span> <span class="n">the</span> <span class="n">radial</span> <span class="n">coordinate</span>
<span class="n">hr</span><span class="o">=</span><span class="n">r</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">-</span><span class="n">r</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>       <span class="o">%</span> <span class="n">Determine</span> <span class="n">the</span> <span class="n">grid</span> <span class="n">spacing</span>

<span class="n">M</span> <span class="o">=</span> <span class="n">zeros</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">n</span><span class="p">);</span>     <span class="o">%</span> <span class="n">Construct</span> <span class="n">the</span> <span class="n">grid</span>


<span class="o">%</span> <span class="n">CONSTRUCTION</span> <span class="n">OF</span> <span class="n">COEFFICIENTS</span> <span class="n">FOR</span> <span class="n">INTERIOR</span> <span class="n">NODES</span>
<span class="k">for</span> <span class="n">k</span><span class="o">=</span><span class="mi">2</span><span class="p">:</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span>
    <span class="n">M</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">=</span><span class="p">(</span><span class="n">r</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="o">-</span><span class="n">hr</span><span class="p">);</span>            
    <span class="n">M</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">=-</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">r</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="o">+</span><span class="n">bloss</span><span class="o">*</span><span class="n">hr</span><span class="o">^</span><span class="mi">2</span><span class="o">*</span><span class="n">r</span><span class="p">(</span><span class="n">k</span><span class="p">));</span>
    <span class="n">M</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">=</span><span class="p">(</span><span class="n">r</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="o">+</span><span class="n">hr</span><span class="p">);</span>
<span class="n">end</span>

<span class="o">%</span> <span class="n">alternative</span> <span class="n">approach</span> <span class="n">using</span> <span class="n">diag</span><span class="p">:</span>
<span class="o">%</span> <span class="n">rint</span> <span class="o">=</span> <span class="n">r</span><span class="p">(</span><span class="mi">2</span><span class="p">:</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span>
<span class="o">%</span> <span class="n">diag</span><span class="p">(</span><span class="n">rint</span><span class="o">-</span><span class="n">hr</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="n">diag</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="o">+</span><span class="n">bloss</span><span class="o">*</span><span class="n">hr</span><span class="o">^</span><span class="mi">2</span><span class="o">*</span><span class="n">rint</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span> <span class="o">+</span> <span class="n">diag</span><span class="p">(</span><span class="n">rint</span><span class="o">+</span><span class="n">hr</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>

<span class="o">%</span> <span class="n">CONSTRUCTION</span> <span class="n">OF</span> <span class="n">COEFFICIENTS</span> <span class="n">FOR</span> <span class="n">BOUNDARY</span> <span class="n">NODES</span>
<span class="n">M</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span> <span class="n">M</span><span class="p">(</span><span class="n">end</span><span class="p">,</span><span class="n">end</span><span class="p">)</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span>

<span class="o">%</span> <span class="n">CONSTRUCTION</span> <span class="n">OF</span> <span class="n">RHS</span>
<span class="n">b</span><span class="o">=</span><span class="n">zeros</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span><span class="n">b</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span><span class="n">b</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="o">=</span><span class="mf">0.1</span><span class="p">;</span> <span class="o">%</span> <span class="n">interior</span> <span class="o">+</span> <span class="n">boundary</span>

<span class="n">sol1</span><span class="o">=</span><span class="p">(</span><span class="n">M</span>\<span class="n">b</span><span class="p">)</span><span class="o">.</span><span class="s1">&#39;;</span>
</pre></div>
</div>
<p><strong>Part 3: Gauss-Seidel method</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%</span> <span class="n">Set</span> <span class="n">up</span> <span class="n">an</span> <span class="n">initial</span> <span class="n">grid</span> <span class="k">for</span> <span class="n">the</span> <span class="n">solution</span>
<span class="n">c</span><span class="o">=</span><span class="n">zeros</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">n</span><span class="p">);</span> <span class="n">c</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">c</span><span class="p">(</span><span class="n">end</span><span class="p">)</span><span class="o">=</span><span class="mf">0.1</span><span class="p">;</span>

<span class="k">for</span> <span class="n">j</span><span class="o">=</span><span class="mi">1</span><span class="p">:</span><span class="mi">1000</span> <span class="o">%</span><span class="n">bound</span> <span class="n">on</span> <span class="n">maximum</span> <span class="n">number</span> <span class="n">of</span> <span class="n">iterations</span>
    <span class="k">for</span> <span class="n">k</span><span class="o">=</span><span class="mi">2</span><span class="p">:</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span>
        <span class="n">c</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="p">((</span><span class="n">r</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="o">+</span><span class="n">hr</span><span class="p">)</span><span class="o">*</span><span class="n">c</span><span class="p">(</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span><span class="p">(</span><span class="n">r</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="o">-</span><span class="n">hr</span><span class="p">)</span><span class="o">*</span><span class="n">c</span><span class="p">(</span><span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">r</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="o">+</span><span class="n">bloss</span><span class="o">*</span><span class="n">hr</span><span class="o">^</span><span class="mi">2</span><span class="o">*</span><span class="n">r</span><span class="p">(</span><span class="n">k</span><span class="p">));</span>
    <span class="n">end</span>
    <span class="k">if</span> <span class="n">norm</span><span class="p">(</span><span class="n">c</span><span class="o">-</span><span class="n">sol1</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">1e-4</span>
         <span class="n">fprintf</span><span class="p">(</span><span class="s1">&#39;Converged after </span><span class="si">%d</span><span class="s1"> iterations,&#39;</span><span class="p">,</span><span class="n">j</span><span class="p">)</span>
        <span class="k">break</span>
    <span class="n">end</span>
<span class="n">end</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%</span> <span class="n">Plots</span>
<span class="n">figure</span>
<span class="n">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plot</span><span class="p">(</span><span class="n">r</span><span class="p">,</span><span class="n">sol1</span><span class="p">,</span><span class="s1">&#39;b&#39;</span><span class="p">)</span>
<span class="n">title</span><span class="p">(</span><span class="s1">&#39;Solution by Matrix method&#39;</span><span class="p">)</span>
<span class="n">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<span class="n">plot</span><span class="p">(</span><span class="n">r</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
<span class="n">title</span><span class="p">(</span><span class="s1">&#39;Solution by Gauss-Seidel method&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="d-wave-equation-with-cauchy-conditions">
<h2><span class="section-number">7.3. </span>1D wave equation with Cauchy conditions<a class="headerlink" href="#d-wave-equation-with-cauchy-conditions" title="Permalink to this headline">¶</a></h2>
<p>In this example we will solve the problem</p>
<div class="math notranslate nohighlight">
\[\frac{\partial^2 u}{\partial t^2} = c^2 \frac{\partial^2u}{\partial x^2}, \qquad t\in(0,T), \quad x\in(0,L),
\begin{align}\end{align}\]</div>
<p>Subject to the following initial conditions:</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{equation*}
u(0,x)=2 e^{-(x-L/2)^2}, \quad \frac{\partial u(0,x)}{\partial t}= 0
\end{equation*}\]</div>
<p>and the following boundary conditions:</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{equation*}
u(t,0)=0, \quad u(t,L)=0.
\end{equation*}\]</div>
<div class="section" id="solution">
<h3><span class="section-number">7.3.1. </span>Solution<a class="headerlink" href="#solution" title="Permalink to this headline">¶</a></h3>
<p>We will define the following solution grid</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{align*}
t_{n}&amp;=n\Delta_t,\quad \ &amp; n=0,\ldots,N_{t}, \\
x_{i}&amp;=i\Delta_x,\quad \ &amp; i=0, \ldots,N_{x} \thinspace.
\end{align*}\]</div>
<p>Application of a central differences formulae for the derivatives then gives</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{equation*}\tag{tstep}
u^{n+1}_{i}=-u^{n-1}_{i}+2u^{n}_{i}+\left(c\frac{\Delta_t}{\Delta_x}\right)^{2}\left(u^{n}_{i+1}-2u^{n}_{i}+u^{n}_{i-1}\right),  \quad i=[1,\dots N_x-1 ],
\end{equation*}\]</div>
<p>where a  superscript has been used to denote the temporal discretisation and a subscript has been used to denote the temporal discretisation. This formula uses the result at two previous time steps. The given Dirichlet-type conditions for the spatial boundary can be applied by forced modification of the boundary nodes, <span class="math notranslate nohighlight">\(u^{n}_0=u^{n}_{N_x}=0\)</span>, <span class="math notranslate nohighlight">\(n\in[0,\dots N_t]\)</span>.</p>
<p>The initial conditions allow a forward-stepping algorithm to be used. The starting value for <span class="math notranslate nohighlight">\(u^1_i \)</span> is given by combining the initial condition for the derivative with the ODE formula, which gives</p>
<div class="amsmath math notranslate nohighlight" id="equation-0bd1a682-1404-494c-820f-a13a4caddef7">
<span class="eqno">(7.2)<a class="headerlink" href="#equation-0bd1a682-1404-494c-820f-a13a4caddef7" title="Permalink to this equation">¶</a></span>\[\begin{equation}\tag{interior}u_{i}^{1}=u^{0}_{i}-\frac{1}{2}\left(c\frac{\Delta_t}{\Delta_x}\right)^{2}\left(u^{0}_{i+1}-2u^{0}_{i}+u^{0}_{i-1}\right)\thinspace., \quad i=[1,\dots N_x-1 ].\end{equation}\]</div>
<p>Summary of steps:</p>
<ol class="simple">
<li><p>Compute <span class="math notranslate nohighlight">\(u^0_{i}\)</span> for <span class="math notranslate nohighlight">\(i\in[0,\dots N_x]\)</span> from the given initial condition</p></li>
<li><p>Compute <span class="math notranslate nohighlight">\(u^1_{i}\)</span> from (interior), applying BCs <span class="math notranslate nohighlight">\(u^{1}_0=u^{1}_{N_x}\)</span></p></li>
<li><p>Compute <span class="math notranslate nohighlight">\(u^{n+1}_{i}\)</span> from (tstep) for <span class="math notranslate nohighlight">\(n=[0,\dots N_t-1]\)</span>, applying BCs <span class="math notranslate nohighlight">\(u^{n}_0=u^{n}_{N_x}\)</span> in each step</p></li>
<li><p>Solve the problem for the case where <span class="math notranslate nohighlight">\(L=4\pi\)</span>, <span class="math notranslate nohighlight">\(T=20\)</span>, <span class="math notranslate nohighlight">\(c=4\)</span>, and plot <span class="math notranslate nohighlight">\(u(t,x)\)</span>.</p></li>
</ol>
<p><strong>Solution</strong></p>
<p>Discretise temporal and spatial variables:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">clear</span><span class="p">;</span>
<span class="n">c</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span> <span class="n">L</span> <span class="o">=</span> <span class="mi">4</span><span class="o">*</span><span class="n">pi</span><span class="p">;</span> <span class="n">T</span> <span class="o">=</span> <span class="mi">20</span><span class="p">;</span> <span class="o">%</span> <span class="n">given</span> <span class="n">parameters</span>

<span class="n">x</span> <span class="o">=</span> <span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">L</span><span class="p">);</span>  <span class="o">%</span> <span class="n">discretisation</span> <span class="n">of</span> <span class="n">spatial</span> <span class="n">dimension</span>
<span class="n">Dx</span><span class="o">=</span> <span class="n">x</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">-</span><span class="n">x</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>      <span class="o">%</span> <span class="n">spatial</span> <span class="n">step</span> <span class="n">size</span>

<span class="n">r</span><span class="o">=</span><span class="mf">0.95</span><span class="p">;</span> <span class="n">Dt</span><span class="o">=</span><span class="n">r</span><span class="o">*</span><span class="n">Dx</span><span class="o">/</span><span class="n">c</span><span class="p">;</span>  <span class="o">%</span><span class="n">temporal</span> <span class="n">step</span> <span class="n">size</span> <span class="n">via</span> <span class="n">Courant</span> <span class="n">parameter</span> <span class="n">r</span>

<span class="o">%</span> <span class="n">Note</span><span class="p">:</span> <span class="n">Dt</span><span class="p">,</span> <span class="n">Dx</span> <span class="n">are</span> <span class="n">arbitrary</span><span class="p">,</span> <span class="n">but</span> <span class="n">keep</span> <span class="n">r</span><span class="o">=</span><span class="n">c</span><span class="o">*</span><span class="n">Dt</span><span class="o">/</span><span class="n">Dx</span> <span class="o">&lt;</span> <span class="mi">1</span> <span class="k">for</span> <span class="n">stability</span><span class="o">.</span>
<span class="o">%</span> <span class="n">Try</span> <span class="n">r</span><span class="o">=</span><span class="mf">1.01</span> <span class="n">to</span> <span class="n">see</span> <span class="n">what</span> <span class="n">happens</span> <span class="n">when</span> <span class="n">this</span> <span class="n">condition</span> <span class="ow">is</span> <span class="n">violated</span><span class="o">.</span>

<span class="n">t</span> <span class="o">=</span> <span class="mi">0</span><span class="p">:</span><span class="n">Dt</span><span class="p">:</span><span class="n">T</span><span class="p">;</span>         <span class="o">%</span><span class="n">discretisation</span> <span class="n">of</span> <span class="n">temporal</span> <span class="n">dimension</span>

<span class="n">Nx</span><span class="o">=</span><span class="n">numel</span><span class="p">(</span><span class="n">x</span><span class="p">);</span> <span class="n">Nt</span><span class="o">=</span><span class="n">numel</span><span class="p">(</span><span class="n">t</span><span class="p">);</span>
</pre></div>
</div>
<p>Set up a grid to record <span class="math notranslate nohighlight">\(u(t_n,x_i)\)</span></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">u</span> <span class="o">=</span> <span class="n">zeros</span><span class="p">(</span><span class="n">Nt</span><span class="p">,</span><span class="n">Nx</span><span class="p">);</span>                          <span class="o">%</span><span class="n">solution</span> <span class="n">grid</span>
<span class="n">ii</span><span class="o">=</span><span class="mi">2</span><span class="p">:</span><span class="n">Nx</span><span class="o">-</span><span class="mi">1</span><span class="p">;</span>                                 <span class="o">%</span><span class="n">interior</span> <span class="n">x</span> <span class="n">indices</span>
<span class="o">%--------------------------------------------------------------</span>
<span class="o">%</span> <span class="n">FILL</span> <span class="n">IN</span> <span class="n">INITIAL</span> <span class="n">CONDITIONS</span>
<span class="n">u</span><span class="p">(</span><span class="mi">1</span><span class="p">,:)</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="n">L</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">.^</span><span class="mi">2</span><span class="p">);</span>                              <span class="o">%</span><span class="n">u</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">x</span><span class="p">)</span>

<span class="o">%</span><span class="n">For</span> <span class="n">a</span> <span class="n">standing</span> <span class="n">wave</span> <span class="n">solution</span> <span class="k">try</span> <span class="n">instead</span> <span class="p">(</span><span class="n">where</span> <span class="n">k</span> <span class="ow">is</span> <span class="n">an</span> <span class="n">integer</span><span class="p">)</span>
<span class="o">%</span><span class="n">k</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span> <span class="n">u</span><span class="p">(</span><span class="mi">1</span><span class="p">,:)</span><span class="o">=</span><span class="n">sin</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="o">*</span><span class="n">k</span><span class="o">*</span><span class="n">x</span><span class="o">/</span><span class="n">L</span><span class="p">);</span>

<span class="n">u</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">ii</span><span class="p">)</span> <span class="o">=</span> <span class="n">u</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">ii</span><span class="p">)</span><span class="o">-</span><span class="n">r</span><span class="o">^</span><span class="mi">2</span><span class="o">/</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">u</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">ii</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">u</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">ii</span><span class="p">)</span><span class="o">+</span><span class="n">u</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">ii</span><span class="o">-</span><span class="mi">1</span><span class="p">));</span>  <span class="o">%</span><span class="n">u</span><span class="p">(</span><span class="n">Dt</span><span class="p">,</span><span class="n">x</span><span class="p">)</span>

<span class="o">%--------------------------------------------------------------</span>
<span class="o">%</span> <span class="n">APPLY</span> <span class="n">UPDATE</span> <span class="n">RULES</span>
<span class="k">for</span> <span class="n">n</span> <span class="o">=</span> <span class="mi">3</span><span class="p">:</span><span class="n">Nt</span>
    <span class="n">neigh</span><span class="o">=</span><span class="n">u</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">ii</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">u</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">ii</span><span class="p">)</span><span class="o">+</span><span class="n">u</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">ii</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span>
    <span class="n">u</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">ii</span><span class="p">)</span><span class="o">=-</span><span class="n">u</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="n">ii</span><span class="p">)</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">u</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">ii</span><span class="p">)</span><span class="o">+</span><span class="n">r</span><span class="o">^</span><span class="mi">2</span><span class="o">*</span><span class="n">neigh</span><span class="p">;</span>
<span class="n">end</span>
<span class="o">%--------------------------------------------------------------</span>
</pre></div>
</div>
<p>A surface plot of the solution shows that</p>
<ul class="simple">
<li><p>the initial disturbance propagates away from the origin in both directions</p></li>
<li><p>disturbances are reflected at both boundaries and travel back along the mirror path</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">X</span><span class="p">,</span><span class="n">T</span><span class="p">]</span><span class="o">=</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">t</span><span class="p">);</span>
<span class="n">figure</span>
<span class="n">surfc</span><span class="p">(</span><span class="n">T</span><span class="p">,</span><span class="n">X</span><span class="p">,</span><span class="n">u</span><span class="p">,</span><span class="s1">&#39;LineStyle&#39;</span><span class="p">,</span><span class="s1">&#39;none&#39;</span><span class="p">)</span>
<span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;t&#39;</span><span class="p">);</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>We can also produce a time animation of the behaviour</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="n">figure</span><span class="p">;</span><span class="n">s</span><span class="o">=</span><span class="nb">round</span><span class="p">(</span><span class="mf">0.1</span><span class="o">/</span><span class="n">Dt</span><span class="p">);</span><span class="n">N</span><span class="o">=</span><span class="mi">8</span><span class="o">/</span><span class="n">Dt</span><span class="p">;</span>
<span class="o">%</span><span class="k">for</span> <span class="n">n</span> <span class="o">=</span> <span class="mi">1</span><span class="p">:</span><span class="n">s</span><span class="p">:</span><span class="n">N</span>
<span class="o">%</span>    <span class="n">cla</span><span class="p">;</span> <span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">u</span><span class="p">(</span><span class="n">n</span><span class="p">,:));</span> <span class="n">axis</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="n">L</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">]);</span> <span class="n">drawnow</span><span class="p">;</span>
<span class="o">%</span>    <span class="n">pause</span><span class="p">(</span><span class="mf">0.1</span><span class="p">);</span>
<span class="o">%</span><span class="n">end</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="damped-1d-wave-equation">
<h2><span class="section-number">7.4. </span>Damped 1D wave equation<a class="headerlink" href="#damped-1d-wave-equation" title="Permalink to this headline">¶</a></h2>
<p>The one-dimensional damped wave equation is given by</p>
<div class="math notranslate nohighlight">
\[\frac{\partial^2\phi}{\partial t^2}+\gamma \frac{\partial \phi}{\partial t}=c^2\frac{\partial^2\phi}{\partial x^2}.\]</div>
<p>By using the central difference formulas the equation of motion can be written in the following discretised form:</p>
<div class="math notranslate nohighlight" id="equation-dampwave">
<span class="eqno">(7.3)<a class="headerlink" href="#equation-dampwave" title="Permalink to this equation">¶</a></span>\[\left(1+\frac{\gamma}{2}\Delta t\right)\phi_{i+1,j} = 2\phi_{i,j}+r^2(\phi_{i,j-1}-2\phi_{i,j}+\phi_{i,j+1})-\phi_{i-1,j}\left(1-\frac{\gamma}{2}\Delta t\right),\]</div>
<p>where <span class="math notranslate nohighlight">\(r=\frac{c\Delta t}{\Delta x}\)</span> and <span class="math notranslate nohighlight">\(\phi_{i,j}=\phi(t_i,x_j)\)</span>. We will take <span class="math notranslate nohighlight">\(c=0.2\)</span>, <span class="math notranslate nohighlight">\(\gamma=-0.5\)</span>.</p>
<p><strong>Step 1:</strong>
Employ a suitable discretisation based on the time iteration formula <a class="reference internal" href="#equation-dampwave">(7.3)</a> to solve the damped wave equation for <span class="math notranslate nohighlight">\(t\in[0,4]\)</span>, <span class="math notranslate nohighlight">\(x\in[0,2]\)</span> subject to</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{equation*}
\phi(t=0) = \sin\left(2\pi x\right), \quad \phi(t=\Delta t) = \sin\left(2\pi (x-c\Delta t)\right).
\end{equation*}\]</div>
<p>Due to the periodicity of the disturbance, the end-conditions on the spatial grid can be taken such that the solution “wraps around”, i.e.</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{equation*}
\phi(x=-\Delta x) = \phi(x=2\pi), \quad \phi(x=2\pi +\Delta x)=\phi(x=0).
\end{equation*}\]</div>
<p>You may find the <code class="docutils literal notranslate"><span class="pre">circshift</span></code> function useful in constructing your answer.</p>
<p><strong>Step 2:</strong>
Produce a surface plot of your solution for <span class="math notranslate nohighlight">\(\phi(x,t)\)</span> and label the axes.</p>
<p><strong>Step 3:</strong>
To illustrate the amplitude evolution of the disturbance, produce a plot of</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{equation*}
\frac{\phi_{max}(t=t_i)}{\phi_{max}(t=0)}\quad \text{for}\quad t_i\in[0,4].
\end{equation*}\]</div>
<p><strong>Step 4:</strong>
Use your surface plot and amplitude evolution plot to comment on the behaviour of the disturbance.</p>
<p><strong>Step 5:</strong>
Describe how the accuracy and convergence/stability of the solution depend on <span class="math notranslate nohighlight">\(\Delta t\)</span>, <span class="math notranslate nohighlight">\(\Delta x\)</span> and the Courant parameter <span class="math notranslate nohighlight">\(r\)</span>.</p>
<p><strong>Solution</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">clear</span><span class="p">;</span>
<span class="n">c</span> <span class="o">=</span> <span class="mf">0.2</span><span class="p">;</span> <span class="n">g</span><span class="o">=</span><span class="mf">0.5</span><span class="p">;</span> <span class="n">L</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span> <span class="n">T</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span> <span class="o">%</span> <span class="n">given</span> <span class="n">parameters</span>

<span class="n">Nt</span><span class="o">=</span><span class="mi">81</span><span class="p">;</span> <span class="n">Nx</span><span class="o">=</span><span class="mi">200</span><span class="p">;</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">L</span><span class="p">,</span><span class="n">Nx</span><span class="p">);</span>  <span class="o">%</span> <span class="n">discretisation</span> <span class="n">of</span> <span class="n">spatial</span> <span class="n">dimension</span>
<span class="n">t</span> <span class="o">=</span> <span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">T</span><span class="p">,</span><span class="n">Nt</span><span class="p">);</span>  <span class="o">%</span> <span class="n">discretisation</span> <span class="n">of</span> <span class="n">spatial</span> <span class="n">parameter</span>
<span class="n">Dt</span><span class="o">=</span><span class="n">T</span><span class="o">/</span><span class="p">(</span><span class="n">Nt</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span> <span class="n">Dx</span><span class="o">=</span><span class="n">L</span><span class="o">/</span><span class="p">(</span><span class="n">Nx</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span>

<span class="n">r</span><span class="o">=</span><span class="n">c</span><span class="o">*</span><span class="n">Dt</span><span class="o">/</span><span class="n">Dx</span>              <span class="o">%</span> <span class="n">ensure</span> <span class="n">it</span><span class="s1">&#39;s less than 1</span>

<span class="n">F</span><span class="o">=</span><span class="n">zeros</span><span class="p">(</span><span class="n">Nt</span><span class="p">,</span><span class="n">Nx</span><span class="p">);</span>
<span class="n">F</span><span class="p">(</span><span class="mi">1</span><span class="p">,:)</span><span class="o">=</span><span class="n">sin</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="o">*</span><span class="n">x</span><span class="p">);</span>            <span class="o">%</span><span class="n">phi</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">x</span><span class="p">)</span>
<span class="n">F</span><span class="p">(</span><span class="mi">2</span><span class="p">,:)</span> <span class="o">=</span> <span class="n">sin</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="o">*</span><span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="n">c</span><span class="o">*</span><span class="n">Dt</span><span class="p">));</span>   <span class="o">%</span><span class="n">phi</span><span class="p">(</span><span class="n">Dt</span><span class="p">,</span><span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="n">see</span> <span class="n">comment</span> <span class="n">at</span> <span class="n">end</span>

<span class="o">%</span><span class="n">w</span><span class="o">=</span><span class="n">sqrt</span><span class="p">(</span><span class="n">c</span><span class="o">^</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="p">)</span><span class="o">^</span><span class="mi">2</span><span class="o">-</span><span class="n">g</span><span class="o">^</span><span class="mi">2</span><span class="o">/</span><span class="mi">4</span><span class="p">);</span>
<span class="o">%</span><span class="n">cp</span><span class="o">=</span><span class="n">w</span><span class="o">/</span><span class="mi">2</span><span class="o">/</span><span class="n">pi</span><span class="p">;</span>
<span class="o">%</span><span class="n">F</span><span class="p">(</span><span class="mi">2</span><span class="p">,:)</span><span class="o">=</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">g</span><span class="o">/</span><span class="mi">2</span><span class="o">*</span><span class="n">Dt</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="o">*</span><span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="n">cp</span><span class="o">*</span><span class="n">Dt</span><span class="p">));</span>

<span class="n">K0</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">g</span><span class="o">*</span><span class="n">Dt</span><span class="o">/</span><span class="mi">2</span><span class="p">);</span> <span class="n">K2</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">g</span><span class="o">*</span><span class="n">Dt</span><span class="o">/</span><span class="mi">2</span><span class="p">);</span>  <span class="o">%</span><span class="n">constants</span> <span class="n">appearing</span> <span class="ow">in</span> <span class="n">update</span> <span class="n">rule</span>

<span class="k">for</span> <span class="n">i</span><span class="o">=</span><span class="mi">2</span><span class="p">:</span><span class="n">Nt</span><span class="o">-</span><span class="mi">1</span>
   <span class="n">f</span><span class="o">=</span><span class="n">F</span><span class="p">(</span><span class="n">i</span><span class="p">,:);</span>
    <span class="n">neigh</span><span class="o">=</span><span class="n">circshift</span><span class="p">(</span><span class="n">f</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">f</span><span class="o">+</span><span class="n">circshift</span><span class="p">(</span><span class="n">f</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span>
    <span class="n">F</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,:)</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">f</span><span class="o">+</span><span class="n">r</span><span class="o">^</span><span class="mi">2</span><span class="o">*</span><span class="n">neigh</span><span class="o">-</span><span class="n">K0</span><span class="o">*</span><span class="n">F</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">,:))</span><span class="o">/</span><span class="n">K2</span><span class="p">;</span>
<span class="n">end</span>

<span class="n">surf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">t</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">5</span><span class="p">:</span><span class="n">end</span><span class="p">),</span><span class="n">F</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">5</span><span class="p">:</span><span class="n">end</span><span class="p">,:),</span><span class="s1">&#39;EdgeColor&#39;</span><span class="p">,</span><span class="s1">&#39;none&#39;</span><span class="p">)</span>
<span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">);</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;t&#39;</span><span class="p">);</span><span class="n">zlabel</span><span class="p">(</span><span class="s1">&#39;\phi&#39;</span><span class="p">)</span>

<span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="nb">max</span><span class="p">(</span><span class="n">F</span><span class="p">,[],</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="nb">max</span><span class="p">(</span><span class="n">F</span><span class="p">(</span><span class="mi">1</span><span class="p">,:)))</span>
<span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;t&#39;</span><span class="p">);</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;\phi_</span><span class="si">{max}</span><span class="s1">&#39;</span><span class="p">);</span>
</pre></div>
</div>
<p>The solution becomes more accurate as the size of the spatial and temporal steps reduces, but needs very small steps to achieve a smooth solution profile.
The stability is sensitive to the Courant parameter . For <span class="math notranslate nohighlight">\(r&lt;1\)</span> the solution converges, whilst for <span class="math notranslate nohighlight">\(r&gt;1\)</span> it does not. You can explore this behaviour by comparing the solutions for nt= 80, 81 for nx=200.</p>
<p><strong>Concerning the given result for : <span class="math notranslate nohighlight">\(\phi(\Delta t,x)\)</span></strong>
The given result came from the analytic solution for the undamped case (when <span class="math notranslate nohighlight">\(\gamma=0\)</span>). Whoever wrote this question must have believed it would give a good approximation to the analytic solution for the undamped case. However, the result given by using this condition is unphysical. Our numeric solution rightly shows a travelling wave of decaying amplitude, but the staggered rate of decay doesn’t match reality.</p>
<p>Hand derivations indicate that the PDE admit particular solutions of the form <span class="math notranslate nohighlight">\(\phi=e^{-\frac{\gamma}{2}t}\sin(kx-\omega t)\)</span>, where <span class="math notranslate nohighlight">\(\omega^2=k^2c^2 -\left(\frac{\gamma}{2}\right)^2\)</span>. If this analytic result is used to determine <span class="math notranslate nohighlight">\(\phi(\Delta t,x)\)</span>, the amplitude will be seen to decay exponentially with rate determined by the strength of the damping. This finding highlights again the importance of taking great care with the accurate implementation of any boundary conditions.</p>
<p><strong>What if we can’t use an analytic solution to determine <span class="math notranslate nohighlight">\(\phi(\Delta t,x)\)</span>?</strong>
In that case, we could determine the result from a pair of initial conditions of the form <span class="math notranslate nohighlight">\(\phi(0,x)=f(x)\)</span>, <span class="math notranslate nohighlight">\(\phi_t(0,x)=g(x)\)</span>, by using the central difference formula for the first derivative boundary condition, in conjunction with the update rule given by the PDE. This is the method used in the previous question for the undamped case.
The functions <span class="math notranslate nohighlight">\(f(x)\)</span> and <span class="math notranslate nohighlight">\(g(x)\)</span> would need to be informed by the physical problem. The solution would (likely) not be a single travelling harmonic, but would consist of a wavepacket (sum of) harmonics.</p>
</div>
<div class="section" id="d-heat-equation-with-dirichlet-conditions">
<h2><span class="section-number">7.5. </span>2D heat equation with Dirichlet conditions<a class="headerlink" href="#d-heat-equation-with-dirichlet-conditions" title="Permalink to this headline">¶</a></h2>
<p>We will consider the problem</p>
<div class="amsmath math notranslate nohighlight" id="equation-272b97ba-3e5a-4e33-9fa3-520f0a90ea94">
<span class="eqno">(7.4)<a class="headerlink" href="#equation-272b97ba-3e5a-4e33-9fa3-520f0a90ea94" title="Permalink to this equation">¶</a></span>\[\begin{equation}
\Delta u=f(x,y), \qquad 0\leq x,y\leq 1, \qquad \Delta = \frac{\partial^2}{\partial x^2}+\frac{\partial^2}{\partial y^2}.
\end{equation}\]</div>
<p>By applying the second derivative central difference formula at the interior points:</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{equation*}
%\begin{rcases}
u_{xx}(x_i,y_j) = \frac{u_{i+1,j}-2u_{i,j}+u_{i-1,j}}{h^2},\quad
u_{yy}(x_i,y_j) = \frac{u_{i,j+1}-2u_{i,j}+u_{i,j-1}}{h^2}.
%\end{rcases}2\leq i,j\leq N-1
\end{equation*}\]</div>
<p>we obtain</p>
<div class="amsmath math notranslate nohighlight" id="equation-eb8a528e-0c28-40d3-882b-2d6a30ace0d1">
<span class="eqno">(7.5)<a class="headerlink" href="#equation-eb8a528e-0c28-40d3-882b-2d6a30ace0d1" title="Permalink to this equation">¶</a></span>\[\begin{equation}\label{fivept}
u_{i,j-1}+u_{i-1,j}-4u_{i,j}+u_{i+1,j}+u_{i,j+1}=h^2 f(x_i,y_j)
\end{equation}\]</div>
<p>This is known as the five-point formula. It can be represented using a stencil:</p>
<br>
<a class="reference internal image-reference" href="../_images/stencil.png"><img alt="secant" class="align-center" src="../_images/stencil.png" style="width: 180.0px; height: 180.0px;" /></a>
<br>
<p>The equation rearranges to the following iterative formula:</p>
<div class="amsmath math notranslate nohighlight" id="equation-fb30e60e-eb3e-4f16-b418-f8aecbfd9337">
<span class="eqno">(7.6)<a class="headerlink" href="#equation-fb30e60e-eb3e-4f16-b418-f8aecbfd9337" title="Permalink to this equation">¶</a></span>\[\begin{equation}\label{discr}
u_{i,j} = \frac{1}{4}\left(u_{i,j-1}+u_{i-1,j}+u_{i+1,j}+u_{i,j+1}-h^2 f(x_i,y_j)\right)
\end{equation}\]</div>
<p><strong>Step 1:</strong>
Solve the problem using an iterative solution technique, for the case where:</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{equation*}
f(x,y) = 2\cos(\pi y)-\pi^2(1+x)^2\cos(\pi y),
\end{equation*}\]</div>
<p>subject to the conditions</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{align*}
u(x,0)=(1+x)^2, \quad u(x,1)=-(1+x)^2,\\
u(0,y)=\cos(\pi y), \quad u(1,y)=4\cos(\pi y).
\end{align*}\]</div>
<p><strong>Step 2:</strong>
Compare your solution to the analytic result, which is given by</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{equation*}
u(x,y)=(1+x)^2\cos(\pi y).
\end{equation*}\]</div>
<p><strong>Step 3:</strong>
Solve the problem using an iterative solution technique, for the case where:</p>
<div class="amsmath math notranslate nohighlight" id="equation-71dbcb60-b7ea-4f53-9000-a459ff88b488">
<span class="eqno">(7.7)<a class="headerlink" href="#equation-71dbcb60-b7ea-4f53-9000-a459ff88b488" title="Permalink to this equation">¶</a></span>\[\begin{equation}
f(x,y)=-5 \sin(3\pi x)\cos(2\pi y),
\end{equation}\]</div>
<p>subject to the conditions</p>
<div class="amsmath math notranslate nohighlight" id="equation-41343ad6-5e5e-43a4-aafe-789c6acb1ce7">
<span class="eqno">(7.8)<a class="headerlink" href="#equation-41343ad6-5e5e-43a4-aafe-789c6acb1ce7" title="Permalink to this equation">¶</a></span>\[\begin{equation}
u_x(0,y)=0, \quad u_x(1,y)=0, \quad u_y(x,0)=0, \quad u_y(x,1)=0.
\end{equation}\]</div>
<p><em>Hint: to enforce the Neumann boundary conditions, you can use the first order central differences approximation</em></p>
<div class="amsmath math notranslate nohighlight">
\[\begin{equation*}
u_x(x,y) = \frac{u(x+h,y)-u(x-h,y)}{2h}, \quad u_y(x,y) = \frac{u(x,y+k)-u(x,y-k)}{2h}
\end{equation*}\]</div>
<p><em>The expressions to enforce these conditions at the boundary are given in terms of the result at nodes outside the boundaries. We can construct the required ``fictitious’’ nodes and remove them from out solution at the end.</em></p>
<p><strong>Part 1:</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">clear</span>

<span class="o">%</span> <span class="n">This</span> <span class="ow">is</span> <span class="n">the</span> <span class="n">RHS</span> <span class="n">of</span> <span class="n">the</span> <span class="n">equation</span>
<span class="n">f</span><span class="o">=@</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)(</span><span class="mi">2</span><span class="o">-</span><span class="n">pi</span><span class="o">^</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">x</span><span class="p">)</span><span class="o">.^</span><span class="mi">2</span><span class="p">)</span><span class="o">.*</span><span class="n">cos</span><span class="p">(</span><span class="n">pi</span><span class="o">*</span><span class="n">y</span><span class="p">);</span>

<span class="o">%</span> <span class="nb">set</span> <span class="n">up</span> <span class="n">the</span> <span class="n">grid</span>
<span class="n">n</span><span class="o">=</span><span class="mi">30</span><span class="p">;</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">n</span><span class="p">);</span> <span class="n">y</span> <span class="o">=</span> <span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">n</span><span class="p">);</span>

<span class="o">%</span> <span class="n">Useful</span> <span class="n">to</span> <span class="n">store</span> <span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span> <span class="ow">in</span> <span class="n">an</span> <span class="n">array</span> <span class="ow">and</span> <span class="n">use</span> <span class="n">F</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">)</span> <span class="n">instead</span> <span class="n">of</span> <span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">(</span><span class="n">i</span><span class="p">),</span><span class="n">y</span><span class="p">(</span><span class="n">k</span><span class="p">))</span>
<span class="p">[</span><span class="n">X</span><span class="p">,</span><span class="n">Y</span><span class="p">]</span><span class="o">=</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="s1">&#39;,y.&#39;</span><span class="p">);</span> <span class="n">F</span><span class="o">=</span><span class="n">f</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">Y</span><span class="p">);</span>

<span class="o">%</span> <span class="n">determine</span> <span class="n">grid</span> <span class="n">size</span>
<span class="n">h</span> <span class="o">=</span><span class="n">x</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">-</span><span class="n">x</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

<span class="o">%</span> <span class="n">to</span> <span class="n">hold</span> <span class="n">the</span> <span class="n">solutions</span>
<span class="n">U</span> <span class="o">=</span> <span class="n">zeros</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">n</span><span class="p">);</span>

<span class="o">%</span> <span class="n">enforce</span> <span class="n">boundary</span> <span class="n">conditions</span>
<span class="n">U</span><span class="p">(</span><span class="mi">1</span><span class="p">,:)</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">x</span><span class="p">)</span><span class="o">.^</span><span class="mi">2</span><span class="p">;</span>    <span class="n">U</span><span class="p">(</span><span class="n">end</span><span class="p">,:)</span><span class="o">=-</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">x</span><span class="p">)</span><span class="o">.^</span><span class="mi">2</span><span class="p">;</span>
<span class="n">U</span><span class="p">(:,</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">cos</span><span class="p">(</span><span class="n">pi</span><span class="o">*</span><span class="n">y</span><span class="p">);</span>   <span class="n">U</span><span class="p">(:,</span><span class="n">end</span><span class="p">)</span><span class="o">=</span><span class="mi">4</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">pi</span><span class="o">*</span><span class="n">y</span><span class="p">);</span>

<span class="o">%</span><span class="n">relaxation</span> <span class="n">parameter</span> <span class="ow">is</span> <span class="n">r</span><span class="o">=</span><span class="mi">1</span> <span class="k">for</span> <span class="n">Gauss</span><span class="o">-</span><span class="n">Seidel</span><span class="o">.</span>
<span class="o">%</span> <span class="n">You</span> <span class="n">could</span> <span class="k">try</span> <span class="n">some</span> <span class="n">higher</span> <span class="n">values</span> <span class="k">for</span> <span class="n">relaxation</span><span class="o">.</span>
<span class="n">r</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span>

<span class="p">[</span><span class="n">n</span><span class="p">,</span><span class="n">m</span><span class="p">]</span> <span class="o">=</span> <span class="n">size</span><span class="p">(</span><span class="n">U</span><span class="p">);</span>
<span class="k">for</span> <span class="n">k</span> <span class="o">=</span> <span class="mi">1</span><span class="p">:</span><span class="mi">300</span> <span class="o">%</span><span class="k">for</span> <span class="n">each</span> <span class="n">sweep</span>
    <span class="k">for</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">2</span><span class="p">:</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span>
        <span class="k">for</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">2</span><span class="p">:</span><span class="n">m</span><span class="o">-</span><span class="mi">1</span>
            <span class="n">Unew</span> <span class="o">=</span> <span class="p">(</span><span class="n">U</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="p">)</span><span class="o">+</span><span class="n">U</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="p">)</span><span class="o">+</span><span class="n">U</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="n">U</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span><span class="o">/</span><span class="mi">4</span><span class="o">-</span><span class="n">h</span><span class="o">^</span><span class="mi">2</span><span class="o">/</span><span class="mi">4</span><span class="o">*</span><span class="n">F</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">);</span>
            <span class="n">U</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">)</span> <span class="o">=</span> <span class="n">U</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">)</span><span class="o">+</span><span class="n">r</span><span class="o">*</span><span class="p">(</span><span class="n">Unew</span><span class="o">-</span><span class="n">U</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">));</span>
        <span class="n">end</span>
    <span class="n">end</span>
<span class="n">end</span>

<span class="o">%</span> <span class="n">compare</span> <span class="n">to</span> <span class="n">analytic</span> <span class="n">results</span>
<span class="n">T</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">X</span><span class="p">)</span><span class="o">.^</span><span class="mf">2.</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">pi</span><span class="o">*</span><span class="n">Y</span><span class="p">);</span>

<span class="n">figure</span>
<span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">surf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">T</span><span class="p">);</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Exact&#39;</span><span class="p">)</span>
<span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<span class="n">surf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="nb">abs</span><span class="p">(</span><span class="n">U</span><span class="o">-</span><span class="n">T</span><span class="p">));</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Gauss-Seidel error&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>Part 2:</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%</span> <span class="n">This</span> <span class="ow">is</span> <span class="n">the</span> <span class="n">RHS</span> <span class="n">of</span> <span class="n">the</span> <span class="n">equation</span>
<span class="n">f</span><span class="o">=@</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)(</span><span class="o">-</span><span class="mi">5</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="mi">3</span><span class="o">*</span><span class="n">pi</span><span class="o">*</span><span class="n">x</span><span class="p">)</span><span class="o">.*</span><span class="n">cos</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="o">*</span><span class="n">y</span><span class="p">));</span>

<span class="o">%</span> <span class="nb">set</span> <span class="n">up</span> <span class="n">the</span> <span class="n">grid</span>
<span class="n">n</span><span class="o">=</span><span class="mi">30</span><span class="p">;</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">n</span><span class="p">);</span> <span class="n">y</span> <span class="o">=</span> <span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">n</span><span class="p">);</span>

<span class="p">[</span><span class="n">X</span><span class="p">,</span><span class="n">Y</span><span class="p">]</span><span class="o">=</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">);</span>
<span class="n">F</span><span class="o">=</span><span class="n">f</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">Y</span><span class="p">);</span>

<span class="o">%</span> <span class="n">determine</span> <span class="n">grid</span> <span class="n">size</span>
<span class="n">h</span> <span class="o">=</span><span class="n">x</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">-</span><span class="n">x</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

<span class="o">%</span> <span class="n">the</span> <span class="n">solution</span> <span class="n">grid</span> <span class="ow">is</span> <span class="n">padded</span> <span class="k">with</span> <span class="n">fictitious</span> <span class="n">nodes</span> <span class="n">to</span> <span class="n">remove</span> <span class="n">at</span> <span class="n">the</span> <span class="n">end</span>
<span class="n">U</span> <span class="o">=</span> <span class="n">zeros</span><span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="n">n</span><span class="o">+</span><span class="mi">2</span><span class="p">);</span>

<span class="o">%</span> <span class="n">we</span> <span class="n">need</span> <span class="n">to</span> <span class="n">pad</span> <span class="n">F</span> <span class="k">as</span> <span class="n">well</span><span class="p">,</span> <span class="n">so</span> <span class="n">that</span> <span class="n">the</span> <span class="n">two</span> <span class="n">grids</span> <span class="n">are</span> <span class="ow">not</span> <span class="n">mismatched</span>
<span class="n">F</span><span class="o">=</span><span class="n">padarray</span><span class="p">(</span><span class="n">F</span><span class="p">,[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]);</span>

<span class="n">r</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span><span class="o">%</span><span class="n">relaxation</span> <span class="n">parameter</span> <span class="ow">is</span> <span class="mi">1</span> <span class="k">for</span> <span class="n">Gauss</span><span class="o">-</span><span class="n">Seidel</span>

<span class="p">[</span><span class="n">n</span><span class="p">,</span><span class="n">m</span><span class="p">]</span> <span class="o">=</span> <span class="n">size</span><span class="p">(</span><span class="n">U</span><span class="p">);</span>
<span class="k">for</span> <span class="n">k</span> <span class="o">=</span> <span class="mi">1</span><span class="p">:</span><span class="mi">500</span> <span class="o">%</span><span class="k">for</span> <span class="n">each</span> <span class="n">sweep</span>
    <span class="o">%</span><span class="n">enforce</span> <span class="n">boundary</span> <span class="n">conditions</span> <span class="n">on</span> <span class="n">fictitious</span> <span class="n">nodes</span>
    <span class="n">U</span><span class="p">(</span><span class="mi">1</span><span class="p">,:)</span><span class="o">=</span><span class="n">U</span><span class="p">(</span><span class="mi">3</span><span class="p">,:);</span> <span class="n">U</span><span class="p">(</span><span class="n">n</span><span class="p">,:)</span><span class="o">=</span><span class="n">U</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">2</span><span class="p">,:);</span>   
    <span class="n">U</span><span class="p">(:,</span><span class="mi">1</span><span class="p">)</span><span class="o">=</span><span class="n">U</span><span class="p">(:,</span><span class="mi">3</span><span class="p">);</span> <span class="n">U</span><span class="p">(:,</span><span class="n">m</span><span class="p">)</span><span class="o">=</span><span class="n">U</span><span class="p">(:,</span><span class="n">m</span><span class="o">-</span><span class="mi">2</span><span class="p">);</span>
    <span class="k">for</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">2</span><span class="p">:</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span>
        <span class="k">for</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">2</span><span class="p">:</span><span class="n">m</span><span class="o">-</span><span class="mi">1</span>
            <span class="n">Unew</span> <span class="o">=</span> <span class="p">(</span><span class="n">U</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="p">)</span><span class="o">+</span><span class="n">U</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="p">)</span><span class="o">+</span><span class="n">U</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="n">U</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span><span class="o">/</span><span class="mi">4</span><span class="o">-</span><span class="n">h</span><span class="o">^</span><span class="mi">2</span><span class="o">/</span><span class="mi">4</span><span class="o">*</span><span class="n">F</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">);</span>
            <span class="n">U</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">)</span> <span class="o">=</span> <span class="n">U</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">)</span><span class="o">+</span><span class="n">r</span><span class="o">*</span><span class="p">(</span><span class="n">Unew</span><span class="o">-</span><span class="n">U</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">));</span>
        <span class="n">end</span>
    <span class="n">end</span>
<span class="n">end</span>

<span class="n">figure</span>
<span class="n">surf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">U</span><span class="p">(</span><span class="mi">2</span><span class="p">:</span><span class="n">end</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">:</span><span class="n">end</span><span class="o">-</span><span class="mi">1</span><span class="p">));</span>
</pre></div>
</div>
<p>Note: If <span class="math notranslate nohighlight">\(\phi_{sol}\)</span> is a solution of this problem, which satisfies the boundary conditions, then <span class="math notranslate nohighlight">\(\phi_{sol}+C\)</span> is also a solution. Hence, it is possible for the surface to appear shifted up or down in your answers.</p>
<p><strong>Alternatively, using a simultaneous equations technique</strong></p>
<p>The function <code class="docutils literal notranslate"><span class="pre">cdiffM</span></code> below was written to solve the Poisson problem</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{equation*}
\nabla^2\phi=f
\end{equation*}\]</div>
<p>using a matrix method for any possible combination of boundary conditions.
The function sets up the coefficient matrix for the problem <span class="math notranslate nohighlight">\(A\Phi=F\)</span>, where <span class="math notranslate nohighlight">\(F,Phi\)</span> are the function value and unknown solution at each grid node <span class="math notranslate nohighlight">\((x,y)\)</span>, arranged as vectors.
Array <span class="math notranslate nohighlight">\(A\)</span>  is the (sparse) coefficient matrix that relates each node to its neighbours using the five-point formula. The boundary equations are modified to use any specified boundary conditions.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span> <span class="n">Question</span> <span class="mi">1</span>
<span class="o">%</span> <span class="nb">set</span> <span class="n">up</span> <span class="n">the</span> <span class="n">grid</span>
<span class="n">n</span><span class="o">=</span><span class="mi">30</span><span class="p">;</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">n</span><span class="p">);</span> <span class="n">y</span> <span class="o">=</span> <span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">n</span><span class="p">);</span> <span class="p">[</span><span class="n">X</span><span class="p">,</span><span class="n">Y</span><span class="p">]</span><span class="o">=</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">);</span>

<span class="o">%</span><span class="n">determine</span> <span class="n">grid</span> <span class="n">size</span>
<span class="n">h</span> <span class="o">=</span><span class="n">x</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">-</span><span class="n">x</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

<span class="o">%</span> <span class="n">RHS</span> <span class="k">with</span> <span class="n">enforced</span> <span class="n">boundary</span> <span class="n">conditions</span>
<span class="n">F</span> <span class="o">=</span> <span class="n">h</span><span class="o">^</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="mi">2</span><span class="o">-</span><span class="n">pi</span><span class="o">^</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">X</span><span class="p">)</span><span class="o">.^</span><span class="mi">2</span><span class="p">)</span><span class="o">.*</span><span class="n">cos</span><span class="p">(</span><span class="n">pi</span><span class="o">*</span><span class="n">Y</span><span class="p">);</span>
<span class="n">F</span><span class="p">(</span><span class="mi">1</span><span class="p">,:)</span>   <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">x</span><span class="p">)</span><span class="o">.^</span><span class="mi">2</span><span class="p">;</span>   <span class="n">F</span><span class="p">(</span><span class="n">end</span><span class="p">,:)</span> <span class="o">=-</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">x</span><span class="p">)</span><span class="o">.^</span><span class="mi">2</span><span class="p">;</span>
<span class="n">F</span><span class="p">(:,</span><span class="mi">1</span><span class="p">)</span>   <span class="o">=</span> <span class="n">cos</span><span class="p">(</span><span class="n">pi</span><span class="o">*</span><span class="n">y</span><span class="p">);</span>  <span class="n">F</span><span class="p">(:,</span><span class="n">end</span><span class="p">)</span> <span class="o">=</span><span class="mi">4</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">pi</span><span class="o">*</span><span class="n">y</span><span class="p">);</span>
<span class="n">F</span> <span class="o">=</span> <span class="n">F</span><span class="p">(:);</span> <span class="o">%</span> <span class="n">convert</span> <span class="n">to</span> <span class="n">a</span> <span class="nb">list</span>

<span class="o">%</span> <span class="n">LHS</span> <span class="k">with</span> <span class="n">enforced</span> <span class="n">boundary</span> <span class="n">conditions</span>
<span class="n">U</span> <span class="o">=</span> <span class="n">cdiffM</span><span class="p">(</span><span class="n">n</span><span class="p">,{</span><span class="s1">&#39;dirichlet&#39;</span><span class="p">,</span><span class="s1">&#39;dirichlet&#39;</span><span class="p">,</span><span class="s1">&#39;dirichlet&#39;</span><span class="p">,</span><span class="s1">&#39;dirichlet&#39;</span><span class="p">},</span><span class="n">F</span><span class="p">);</span>

<span class="o">%</span> <span class="n">compare</span> <span class="n">to</span> <span class="n">analytic</span> <span class="n">results</span>
<span class="n">U_exact</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">X</span><span class="p">)</span><span class="o">.^</span><span class="mf">2.</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">pi</span><span class="o">*</span><span class="n">Y</span><span class="p">);</span>

<span class="n">figure</span><span class="p">;</span> <span class="n">surf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">U</span><span class="p">);</span>

<span class="o">%%</span> <span class="n">Question</span> <span class="mi">2</span>
<span class="n">n</span><span class="o">=</span><span class="mi">30</span><span class="p">;</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">n</span><span class="p">)</span><span class="o">.</span><span class="s1">&#39;; y = linspace(0,1,n).&#39;</span><span class="p">;</span> <span class="p">[</span><span class="n">X</span><span class="p">,</span><span class="n">Y</span><span class="p">]</span><span class="o">=</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">);</span>

<span class="o">%</span><span class="n">determine</span> <span class="n">grid</span> <span class="n">size</span>
<span class="n">h</span> <span class="o">=</span><span class="n">x</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">-</span><span class="n">x</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

<span class="o">%</span> <span class="n">RHS</span> <span class="k">with</span> <span class="n">enforced</span> <span class="n">boundary</span> <span class="n">conditions</span>
<span class="n">F</span> <span class="o">=</span> <span class="n">h</span><span class="o">^</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="mi">3</span><span class="o">*</span><span class="n">pi</span><span class="o">*</span><span class="n">X</span><span class="p">)</span><span class="o">.*</span><span class="n">cos</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="o">*</span><span class="n">Y</span><span class="p">));</span>
<span class="n">F</span> <span class="o">=</span> <span class="n">padarray</span><span class="p">(</span><span class="n">F</span><span class="p">,[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span><span class="mi">0</span><span class="p">);</span>
<span class="n">F</span> <span class="o">=</span> <span class="n">F</span><span class="p">(:);</span> <span class="o">%</span> <span class="n">convert</span> <span class="n">to</span> <span class="n">a</span> <span class="nb">list</span>

<span class="o">%</span> <span class="n">LHS</span> <span class="k">with</span> <span class="n">enforced</span> <span class="n">boundary</span> <span class="n">conditions</span>
<span class="n">U</span> <span class="o">=</span> <span class="n">cdiffM</span><span class="p">(</span><span class="n">n</span><span class="p">,{</span><span class="s1">&#39;neumann&#39;</span><span class="p">,</span><span class="s1">&#39;neumann&#39;</span><span class="p">,</span><span class="s1">&#39;neumann&#39;</span><span class="p">,</span><span class="s1">&#39;neumann&#39;</span><span class="p">},</span><span class="n">F</span><span class="p">);</span>

<span class="n">figure</span><span class="p">;</span> <span class="n">surf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">U</span><span class="p">);</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">function</span> <span class="n">U</span> <span class="o">=</span> <span class="n">cdiffM</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">LRUD</span><span class="p">,</span><span class="n">F</span><span class="p">)</span>
<span class="o">%</span> <span class="n">Construct</span> <span class="n">the</span> <span class="n">coefficient</span> <span class="n">matrix</span> <span class="k">for</span> <span class="p">(</span><span class="n">nxn</span><span class="p">)</span> <span class="n">implementation</span> <span class="n">of</span> <span class="n">central</span>
<span class="o">%</span> <span class="n">difference</span> <span class="n">formula</span><span class="p">,</span> <span class="k">with</span> <span class="n">dirichlet</span> <span class="ow">or</span> <span class="n">neumann</span> <span class="n">boundary</span> <span class="n">conditions</span><span class="p">,</span> <span class="ow">and</span>
<span class="o">%</span> <span class="n">solve</span> <span class="k">for</span> <span class="n">given</span> <span class="n">forcing</span>
<span class="o">%</span>
<span class="o">%</span> <span class="n">INPUTS</span>
<span class="o">%</span> <span class="n">n</span>    <span class="p">:</span> <span class="n">dimensions</span> <span class="n">of</span> <span class="n">grid</span>
<span class="o">%</span> <span class="n">LRUD</span> <span class="p">:</span> <span class="n">cell</span> <span class="n">array</span> <span class="n">of</span> <span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">,</span> <span class="n">up</span><span class="p">,</span> <span class="n">down</span> <span class="n">boundary</span> <span class="n">types</span>
<span class="o">%</span>        <span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">g</span><span class="o">.</span> <span class="p">{</span><span class="s1">&#39;neumann&#39;</span><span class="p">,</span><span class="s1">&#39;neumann&#39;</span><span class="p">,</span><span class="s1">&#39;neumann&#39;</span><span class="p">,</span><span class="s1">&#39;neumann&#39;</span><span class="p">}</span>
<span class="o">%</span> <span class="n">F</span>    <span class="p">:</span> <span class="n">RHS</span> <span class="n">of</span> <span class="n">equation</span>
<span class="o">%</span>
<span class="o">%</span> <span class="n">OUTPUTS</span>
<span class="o">%</span> <span class="n">U</span>    <span class="p">:</span> <span class="n">solutions</span>

<span class="n">m</span> <span class="o">=</span> <span class="n">n</span><span class="p">;</span>

<span class="o">%</span> <span class="n">Introduce</span> <span class="n">fictitious</span> <span class="n">nodes</span> <span class="n">at</span> <span class="nb">any</span> <span class="n">neumann</span> <span class="n">boundaries</span>
<span class="k">if</span> <span class="n">strcmpi</span><span class="p">(</span><span class="n">LRUD</span><span class="p">{</span><span class="mi">1</span><span class="p">},</span><span class="s1">&#39;neumann&#39;</span><span class="p">),</span> <span class="n">m</span><span class="o">=</span><span class="n">m</span><span class="o">+</span><span class="mi">1</span><span class="p">;</span> <span class="n">end</span>
<span class="k">if</span> <span class="n">strcmpi</span><span class="p">(</span><span class="n">LRUD</span><span class="p">{</span><span class="mi">2</span><span class="p">},</span><span class="s1">&#39;neumann&#39;</span><span class="p">),</span> <span class="n">m</span><span class="o">=</span><span class="n">m</span><span class="o">+</span><span class="mi">1</span><span class="p">;</span> <span class="n">end</span>
<span class="k">if</span> <span class="n">strcmpi</span><span class="p">(</span><span class="n">LRUD</span><span class="p">{</span><span class="mi">3</span><span class="p">},</span><span class="s1">&#39;neumann&#39;</span><span class="p">),</span> <span class="n">n</span><span class="o">=</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">;</span> <span class="n">end</span>
<span class="k">if</span> <span class="n">strcmpi</span><span class="p">(</span><span class="n">LRUD</span><span class="p">{</span><span class="mi">4</span><span class="p">},</span><span class="s1">&#39;neumann&#39;</span><span class="p">),</span> <span class="n">n</span><span class="o">=</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">;</span> <span class="n">end</span>

<span class="n">nodes</span> <span class="o">=</span> <span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">n</span><span class="o">*</span><span class="n">m</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="n">m</span><span class="p">);</span> <span class="o">%</span> <span class="n">number</span> <span class="n">the</span> <span class="n">nodes</span> <span class="ow">in</span> <span class="n">our</span> <span class="p">(</span><span class="n">n</span> <span class="n">x</span> <span class="n">m</span><span class="p">)</span> <span class="n">domain</span>

<span class="n">i</span> <span class="o">=</span> <span class="mi">2</span><span class="p">:</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">;</span>  <span class="n">j</span> <span class="o">=</span> <span class="mi">2</span><span class="p">:</span><span class="n">m</span><span class="o">-</span><span class="mi">1</span><span class="p">;</span>      <span class="o">%</span> <span class="n">location</span> <span class="n">of</span> <span class="n">interior</span> <span class="n">nodes</span>

<span class="o">%</span> <span class="n">nodes</span> <span class="ow">and</span> <span class="n">neighbours</span> <span class="ow">in</span> <span class="n">five</span><span class="o">-</span><span class="n">point</span> <span class="n">formula</span>
<span class="n">C</span> <span class="o">=</span> <span class="n">nodes</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">);</span>
<span class="n">L</span> <span class="o">=</span> <span class="n">nodes</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span> <span class="n">R</span> <span class="o">=</span> <span class="n">nodes</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">);</span>
<span class="n">U</span> <span class="o">=</span> <span class="n">nodes</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="p">);</span> <span class="n">D</span> <span class="o">=</span> <span class="n">nodes</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="p">);</span>

<span class="o">%</span> <span class="n">order</span> <span class="n">the</span> <span class="n">five</span><span class="o">-</span><span class="n">point</span>  <span class="n">indices</span> <span class="k">as</span> <span class="n">a</span> <span class="nb">list</span>
<span class="n">idx</span> <span class="o">=</span> <span class="p">[</span><span class="n">D</span><span class="p">(:),</span> <span class="n">L</span><span class="p">(:),</span> <span class="n">C</span><span class="p">(:),</span> <span class="n">R</span><span class="p">(:),</span> <span class="n">U</span><span class="p">(:)];</span>

<span class="o">%</span> <span class="n">construct</span> <span class="n">the</span> <span class="n">array</span> <span class="n">by</span> <span class="n">looping</span> <span class="n">over</span> <span class="n">the</span> <span class="n">rows</span>
<span class="n">M</span> <span class="o">=</span> <span class="n">zeros</span><span class="p">(</span><span class="n">n</span><span class="o">*</span><span class="n">m</span><span class="p">);</span> <span class="k">for</span> <span class="n">k</span><span class="o">=</span><span class="mi">1</span><span class="p">:</span><span class="n">numel</span><span class="p">(</span><span class="n">C</span><span class="p">),</span> <span class="n">M</span><span class="p">(</span><span class="n">C</span><span class="p">(</span><span class="n">k</span><span class="p">),</span><span class="n">idx</span><span class="p">(</span><span class="n">k</span><span class="p">,:))</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span> <span class="mi">1</span> <span class="o">-</span><span class="mi">4</span> <span class="mi">1</span> <span class="mi">1</span><span class="p">];</span> <span class="n">end</span>

<span class="o">%%</span> <span class="n">apply</span> <span class="n">boundary</span> <span class="n">conditions</span>

<span class="o">%</span> <span class="n">left</span> <span class="n">boundary</span>
<span class="k">if</span> <span class="n">strcmpi</span><span class="p">(</span><span class="n">LRUD</span><span class="p">{</span><span class="mi">1</span><span class="p">},</span><span class="s1">&#39;neumann&#39;</span><span class="p">)</span>
    <span class="n">M</span> <span class="o">=</span> <span class="n">neumann</span><span class="p">(</span><span class="n">M</span><span class="p">,</span><span class="n">nodes</span><span class="p">(:,</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">),[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]);</span>
<span class="k">else</span>
    <span class="n">M</span> <span class="o">=</span> <span class="n">dirichlet</span><span class="p">(</span><span class="n">M</span><span class="p">,</span><span class="n">nodes</span><span class="p">(:,</span><span class="mi">1</span><span class="p">));</span>
<span class="n">end</span>

<span class="o">%</span> <span class="n">right</span> <span class="n">boundary</span>
<span class="k">if</span> <span class="n">strcmpi</span><span class="p">(</span><span class="n">LRUD</span><span class="p">{</span><span class="mi">2</span><span class="p">},</span><span class="s1">&#39;neumann&#39;</span><span class="p">)</span>
    <span class="n">M</span> <span class="o">=</span> <span class="n">neumann</span><span class="p">(</span><span class="n">M</span><span class="p">,</span><span class="n">fliplr</span><span class="p">(</span><span class="n">nodes</span><span class="p">(:,</span><span class="n">end</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">end</span><span class="p">)),[</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">]);</span>
<span class="k">else</span>
    <span class="n">M</span> <span class="o">=</span> <span class="n">dirichlet</span><span class="p">(</span><span class="n">M</span><span class="p">,</span><span class="n">fliplr</span><span class="p">(</span><span class="n">nodes</span><span class="p">(:,</span><span class="n">end</span><span class="p">)));</span>
<span class="n">end</span>

<span class="o">%</span> <span class="n">upper</span> <span class="n">boundary</span>
<span class="k">if</span> <span class="n">strcmpi</span><span class="p">(</span><span class="n">LRUD</span><span class="p">{</span><span class="mi">3</span><span class="p">},</span><span class="s1">&#39;neumann&#39;</span><span class="p">)</span>
    <span class="n">M</span> <span class="o">=</span> <span class="n">neumann</span><span class="p">(</span><span class="n">M</span><span class="p">,</span><span class="n">nodes</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,:)</span><span class="o">.</span><span class="s1">&#39;,[-1,1]);</span>
<span class="k">else</span>
    <span class="n">M</span> <span class="o">=</span> <span class="n">dirichlet</span><span class="p">(</span><span class="n">M</span><span class="p">,</span><span class="n">nodes</span><span class="p">(</span><span class="mi">1</span><span class="p">,:)</span><span class="o">.</span><span class="s1">&#39;);</span>
<span class="n">end</span>

<span class="o">%</span> <span class="n">lower</span> <span class="n">boundary</span>
<span class="k">if</span> <span class="n">strcmpi</span><span class="p">(</span><span class="n">LRUD</span><span class="p">{</span><span class="mi">4</span><span class="p">},</span><span class="s1">&#39;neumann&#39;</span><span class="p">)</span>
    <span class="n">M</span> <span class="o">=</span> <span class="n">neumann</span><span class="p">(</span><span class="n">M</span><span class="p">,</span><span class="n">fliplr</span><span class="p">(</span><span class="n">nodes</span><span class="p">(</span><span class="n">end</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">end</span><span class="p">,:)</span><span class="o">.</span><span class="s1">&#39;),[1,-1]);</span>
<span class="k">else</span>
    <span class="n">M</span> <span class="o">=</span> <span class="n">dirichlet</span><span class="p">(</span><span class="n">M</span><span class="p">,</span><span class="n">nodes</span><span class="p">(</span><span class="n">end</span><span class="p">,:)</span><span class="o">.</span><span class="s1">&#39;);</span>
<span class="n">end</span>

<span class="o">%%</span> <span class="n">solve</span> <span class="n">the</span> <span class="n">system</span>
<span class="n">U</span> <span class="o">=</span> <span class="n">reshape</span><span class="p">(</span><span class="n">M</span>\<span class="n">F</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="n">m</span><span class="p">);</span>

<span class="o">%</span> <span class="n">cut</span> <span class="n">off</span> <span class="nb">any</span> <span class="n">fictitious</span> <span class="n">nodes</span> <span class="n">that</span> <span class="n">were</span> <span class="n">introduced</span>
<span class="k">if</span> <span class="n">strcmpi</span><span class="p">(</span><span class="n">LRUD</span><span class="p">{</span><span class="mi">1</span><span class="p">},</span><span class="s1">&#39;neumann&#39;</span><span class="p">),</span><span class="n">U</span><span class="p">(:,</span><span class="mi">1</span><span class="p">)</span><span class="o">=</span><span class="p">[];</span><span class="n">end</span>
<span class="k">if</span> <span class="n">strcmpi</span><span class="p">(</span><span class="n">LRUD</span><span class="p">{</span><span class="mi">2</span><span class="p">},</span><span class="s1">&#39;neumann&#39;</span><span class="p">),</span><span class="n">U</span><span class="p">(:,</span><span class="n">end</span><span class="p">)</span><span class="o">=</span><span class="p">[];</span><span class="n">end</span>
<span class="k">if</span> <span class="n">strcmpi</span><span class="p">(</span><span class="n">LRUD</span><span class="p">{</span><span class="mi">3</span><span class="p">},</span><span class="s1">&#39;neumann&#39;</span><span class="p">),</span><span class="n">U</span><span class="p">(</span><span class="mi">1</span><span class="p">,:)</span><span class="o">=</span><span class="p">[];</span><span class="n">end</span>
<span class="k">if</span> <span class="n">strcmpi</span><span class="p">(</span><span class="n">LRUD</span><span class="p">{</span><span class="mi">4</span><span class="p">},</span><span class="s1">&#39;neumann&#39;</span><span class="p">),</span><span class="n">U</span><span class="p">(</span><span class="n">end</span><span class="p">,:)</span><span class="o">=</span><span class="p">[];</span><span class="n">end</span>

<span class="n">end</span>

<span class="n">function</span> <span class="n">M</span> <span class="o">=</span> <span class="n">dirichlet</span><span class="p">(</span><span class="n">M</span><span class="p">,</span><span class="n">C</span><span class="p">)</span>
<span class="o">%</span> <span class="n">Apply</span> <span class="n">dirirchlet</span> <span class="n">boundary</span> <span class="n">conditions</span> <span class="n">at</span> <span class="n">nodes</span> <span class="n">numbered</span> <span class="ow">in</span> <span class="n">vector</span> <span class="n">C</span>
    <span class="k">for</span> <span class="n">k</span> <span class="o">=</span> <span class="mi">1</span><span class="p">:</span><span class="n">numel</span><span class="p">(</span><span class="n">C</span><span class="p">),</span> <span class="n">M</span><span class="p">(</span><span class="n">C</span><span class="p">(</span><span class="n">k</span><span class="p">),</span><span class="n">C</span><span class="p">(</span><span class="n">k</span><span class="p">))</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">end</span>
<span class="n">end</span>

<span class="n">function</span> <span class="n">M</span> <span class="o">=</span> <span class="n">neumann</span><span class="p">(</span><span class="n">M</span><span class="p">,</span><span class="n">idx</span><span class="p">,</span><span class="n">coeffs</span><span class="p">)</span>
<span class="o">%</span> <span class="n">Apply</span> <span class="n">neumann</span> <span class="n">boundary</span> <span class="n">conditions</span> <span class="n">at</span> <span class="n">nodes</span> <span class="n">idx</span> <span class="o">=</span> <span class="p">[</span><span class="n">L</span> <span class="n">C</span> <span class="n">R</span><span class="p">]</span> <span class="ow">or</span> <span class="p">[</span><span class="n">U</span> <span class="n">C</span> <span class="n">D</span><span class="p">]</span><span class="o">.</span>
    <span class="k">for</span> <span class="n">k</span> <span class="o">=</span> <span class="mi">1</span><span class="p">:</span><span class="n">size</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="n">M</span><span class="p">(</span><span class="n">idx</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="mi">1</span><span class="p">),[</span><span class="n">idx</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="n">idx</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="mi">3</span><span class="p">)])</span> <span class="o">=</span> <span class="n">coeffs</span><span class="p">;</span> <span class="n">end</span>
<span class="n">end</span>
</pre></div>
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./finitediff"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        
        <div class='prev-next-bottom'>
            
    <a class='left-prev' id="prev-link" href="further_problems.html" title="previous page"><span class="section-number">6. </span>Further problems</a>
    <a class='right-next' id="next-link" href="higher-order.html" title="next page"><span class="section-number">8. </span>Higher order problems (examples)</a>

        </div>
        
        </div>
    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By Natural Sciences<br/>
        
            &copy; Copyright 2021.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>
  
  <script src="../_static/js/index.1c5a1a01449ed65a7b51.js"></script>

  
  </body>
</html>