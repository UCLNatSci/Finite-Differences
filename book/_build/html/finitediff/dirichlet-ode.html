
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>7. Second order BVP &#8212; Finite Differences</title>
    
  <link href="../_static/css/theme.css" rel="stylesheet" />
  <link href="../_static/css/index.c5995385ac14fb8791e8eb36b4908be2.css" rel="stylesheet" />

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/sphinx-book-theme.e8e5499552300ddf5d7adccae7cc3b70.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/exercise.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystyle.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    <link rel="stylesheet" type="text/css" href="../_static/_static/mystyle.css" />
    
  <link rel="preload" as="script" href="../_static/js/index.1c5a1a01449ed65a7b51.js">

    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/togglebutton.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/sphinx-book-theme.12a9622fbb08dcb3a2a40b2c02b83a57.js"></script>
    <script async="async" src="https://unpkg.com/thebelab@latest/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["\\(", "\\)"]], "displayMath": [["\\[", "\\]"]], "processRefs": false, "processEnvironments": false}})</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="8. Partial BVP" href="heat.html" />
    <link rel="prev" title="6. Second order IVP" href="cauchy-ode.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
      
      <h1 class="site-logo" id="site-title">Finite Differences</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../intro.html">
   Finite Differences
  </a>
 </li>
</ul>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="finite-intro.html">
   1. Basic concept
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="formulae.html">
   2. Additional formulae
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="implementation.html">
   3. Differentiation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="ivp.html">
   4. Initial value problem
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="multistage.html">
   5. Multi-stage methods
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="cauchy-ode.html">
   6. Second order IVP
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   7. Second order BVP
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="heat.html">
   8. Partial BVP
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="cauchy-pde.html">
   9. Non-steady BVPs
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="pde_theory.html">
   10. (some) PDE theory
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        <a class="dropdown-buttons"
            href="../_sources/finitediff/dirichlet-ode.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download notebook file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../_sources/finitediff/dirichlet-ode.md"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.md</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/executablebooks/jupyter-book"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/executablebooks/jupyter-book/issues/new?title=Issue%20on%20page%20%2Ffinitediff/dirichlet-ode.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        
    </div>
</div>

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/executablebooks/jupyter-book/master?urlpath=tree/docs/finitediff/dirichlet-ode.md"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="../_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#example">
   7.1. Example
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#fixed-point-method">
   7.2. Fixed point method
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#jacobi-iteration">
     7.2.1. Jacobi iteration
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#gauss-seidel">
     7.2.2. Gauss-Seidel
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#successive-relaxation">
     7.2.3. Successive relaxation
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#axially-symmetric-heat-flow">
   7.3. Axially symmetric heat flow
  </a>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="second-order-bvp">
<h1><span class="section-number">7. </span>Second order BVP<a class="headerlink" href="#second-order-bvp" title="Permalink to this headline">¶</a></h1>
<p>This section is concerned with the solution of a general class of second order ODE, in which we are given a value for the function on two boundaries.</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{equation*}
y^{\prime\prime}=f(y(x),y^{\prime}(x),x), \qquad y(a)=\alpha, \quad y(b)=\beta.
\end{equation*}\]</div>
<p>Boundary value problems are generally more tricky than initial value problems. In 1D problems the problem can be solved by setting up a matrix system of equations for each node. This approach can be generalised to higher dimensions, but it becomes challenging to implement.</p>
<p>In this chapter we will also demonstrate an iterative <strong>relaxation</strong> approach that we will be able to generalise to higher dimensions.</p>
<div class="section" id="example">
<span id="dirode"></span><h2><span class="section-number">7.1. </span>Example<a class="headerlink" href="#example" title="Permalink to this headline">¶</a></h2>
<p>By way of example, we will solve the second order linear ODE that we considered in <a class="reference internal" href="cauchy-ode.html#cauchy-example"><span class="std std-numref">Section 6.1</span></a>, this time using Dirichlet-type boundary conditions at <span class="math notranslate nohighlight">\(x=0,1\)</span>.</p>
<div class="math notranslate nohighlight" id="equation-2order-dir">
<span class="eqno">(7.1)<a class="headerlink" href="#equation-2order-dir" title="Permalink to this equation">¶</a></span>\[\frac{\mathrm{d}^2 y}{\mathrm{d}x^2} + \frac{\mathrm{d}y}{\mathrm{d}x}-6 y = 0, \qquad y(0)=1, \quad y(1)=2.\]</div>
<p>Notice that it is not possible to use the forward-stepping solution technique that we saw in the last chapter, because we do not have a derivative condition that we can use on the left boundary to find gridpoint <span class="math notranslate nohighlight">\(y_1\)</span>. We could simply “guess” this value and then apply the update rule <a class="reference internal" href="cauchy-ode.html#equation-example-upd">(6.5)</a> as illustrated below. Comparison of <span class="math notranslate nohighlight">\(u_n\)</span> to the right-hand boundary value would provide information about how good our guess was.</p>
<br>
<a class="reference internal image-reference" href="../_images/shooting_idea.png"><img alt="secant" class="align-center" src="../_images/shooting_idea.png" style="width: 766.4000000000001px; height: 190.4px;" /></a>
<br>
<p>The guess can be repeatedly modified using a root-finding technique to obtain a value which works. This clever technique is called a <strong>shooting method</strong>. It is fairly straightforward to implement and you may wish to give it a try. However, it does not generalise well to solve PDE problems, so we will use other methods.</p>
<p>We could use the matrix technique that we introduced in <a class="reference internal" href="cauchy-ode.html#matrix-cauchy"><span class="std std-numref">Section 6.4</span></a>. Here, there is no need to introduce a fictitious node. The boundary conditions can be implemented in the first and last rows and we obtain the following matrix system to solve.</p>
<div class="math notranslate nohighlight" id="equation-dirmatr1">
<span class="eqno">(7.2)<a class="headerlink" href="#equation-dirmatr1" title="Permalink to this equation">¶</a></span>\[\begin{split}\left[\begin{array}{cccccc}
1 &amp;0 &amp; 0 &amp; 0 &amp; \dots &amp; 0\\
1-h/2 &amp; -(2+6h^2) &amp; 1+h/2 &amp; 0 &amp; \ddots &amp;\vdots\\
0 &amp; 1-h/2 &amp; -(2+6h^2) &amp; 1+h/2 &amp; \ddots&amp;\vdots\\
\vdots&amp; \ddots &amp; \ddots &amp;\ddots &amp;\ddots &amp; 0\\
0 &amp; \ddots &amp; 0&amp; 1-h/2 &amp; -(2+6h^2) &amp; 1+h/2\\
0 &amp;\dots &amp; 0 &amp; 0 &amp; 0 &amp; 1\end{array}\right]
\left[\begin{array}{cc} y_0\phantom{\vdots}&amp;\\y_1&amp;\phantom{\vdots}\\y_2\phantom{\vdots}&amp;\\ \vdots&amp;\\y_{N-1}\\y_N\end{array}\right]=\left[\begin{array}{cc}1&amp;\phantom{\vdots}\\0&amp;\phantom{\vdots}\\0&amp;\phantom{\vdots}\\\vdots&amp;\\0\\2\end{array}\right]\end{split}\]</div>
<p>The result obtained by numerically solving this system is shown below.</p>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="c1"># Define the nodes</span>
<span class="n">n</span><span class="o">=</span><span class="mi">100</span>                    <span class="c1"># solving with 100 nodes</span>
<span class="n">x</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">n</span><span class="p">)</span>   <span class="c1"># on the domain [0,1]</span>
<span class="n">h</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>          <span class="c1"># size of each interval</span>
<span class="c1">#---------------------------------------------------------------</span>
<span class="c1"># Construct tridiagonal matrix A and vector b</span>
<span class="c1"># Initially we do not worry about implementation of the BCs</span>

<span class="n">coeff1</span> <span class="o">=</span> <span class="mi">1</span><span class="o">-</span><span class="n">h</span><span class="o">/</span><span class="mi">2</span>
<span class="n">coeff2</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span><span class="o">-</span><span class="mi">6</span><span class="o">*</span><span class="n">h</span><span class="o">**</span><span class="mi">2</span>
<span class="n">coeff3</span> <span class="o">=</span> <span class="mi">1</span><span class="o">+</span><span class="n">h</span><span class="o">/</span><span class="mi">2</span>

<span class="n">A</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">coeff1</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span><span class="n">k</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> \
    <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">coeff2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">n</span><span class="p">),</span>  <span class="n">k</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">+</span> \
    <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">coeff3</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span><span class="n">k</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>   <span class="c1"># the problem was homogeneous</span>

<span class="c1">#---------------------------------------------------------------</span>
<span class="c1"># Enforce the boundary conditions</span>

<span class="n">A</span><span class="p">[</span><span class="mi">0</span><span class="p">,[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
<span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="mi">1</span>

<span class="c1">#y_0=1:</span>
<span class="n">A</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
<span class="n">b</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>

<span class="c1">#---------------------------------------------------------------</span>

<span class="c1"># Solve the matrix system numerically</span>
<span class="n">y</span><span class="p">,</span><span class="n">_</span><span class="p">,</span><span class="n">_</span><span class="p">,</span><span class="n">_</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">lstsq</span><span class="p">(</span><span class="n">A</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">rcond</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/dirichlet-ode_1_0.png" class="align-center" src="../_images/dirichlet-ode_1_0.png" />
</div>
</div>
<div class="exercise admonition" id="finitediff/dirichlet-ode-exercise-0">
<p class="admonition-title"><span class="caption-number">Exercise 7.1 </span> </p>
<div class="section" id="exercise-content">
<p>Apply the matrix solution approach to solve the 1D heat equation using a central finite difference scheme</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{equation*}
u^{\prime\prime}(x)=\sin(2\pi x), \qquad u(x_1)=0, \quad u(x_n)=0
\end{equation*}\]</div>
</div>
</div>
<div class="toggle docutils container">
<p><strong>Solution:</strong>
The central difference formula gives</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{equation*}
u_{k+1}-2u_k+u_{k-1}=h^2\sin(2\pi x_k)
\end{equation*}\]</div>
<p>With the boundary conditions included, we obtain the system below, where <span class="math notranslate nohighlight">\(f(x)=\sin(2\pi x)\)</span>.</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{equation*}
\left[\begin{matrix}
1 &amp; 0 &amp; 0 &amp; \dots &amp; \dots &amp; 0 &amp; 0\\
1 &amp; -2 &amp; 1 &amp;&amp;\dots &amp; 0\\
0&amp;1&amp;-2&amp;1\
\vdots&amp;&amp;\ddots&amp;\ddots&amp;\ddots&amp;&amp;\vdots\\
&amp;&amp;&amp;&amp;1&amp;-2&amp;1&amp;0\\]0&amp;\dots &amp;&amp;&amp;1&amp;-2&amp;1\\
0&amp;0&amp;\dots&amp;\dots&amp;0&amp;0&amp;1
\end{matrix}\right]
\left[\begin{matrix}u_1\\u_2\\u_3\\\vdots\\u_{N-2}\\u_{N-1}\\u_N\end{matrix}\right]
=h^2\left[\begin{matrix}0\\f(x_2)\\f(x_3)\\\vdots\\f(x_{N-2})\\f(x_{N-1})\\0\end{matrix}\right]
\end{equation*}\]</div>
<p>The following code can be used to produce the solution:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># The initial setup is the same as before</span>
<span class="n">n</span><span class="o">=</span><span class="mi">100</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">n</span><span class="p">)</span>
<span class="n">h</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>   

<span class="c1"># Create a lambda function for f</span>
<span class="n">f</span><span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">x</span><span class="p">);</span>

<span class="c1"># Construct coefficient matrices :</span>
<span class="kn">from</span> <span class="nn">scipy.sparse</span> <span class="kn">import</span> <span class="n">spdiags</span>
<span class="kn">import</span> <span class="nn">numpy.matlib</span> <span class="k">as</span> <span class="nn">ml</span>
<span class="n">A</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">ml</span><span class="o">.</span><span class="n">repmat</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span><span class="n">n</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
<span class="n">diags</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
<span class="n">A</span> <span class="o">=</span> <span class="n">spdiags</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">diags</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span><span class="o">.</span><span class="n">toarray</span><span class="p">()</span>
<span class="n">A</span><span class="p">[</span><span class="mi">0</span><span class="p">,[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]]</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
<span class="n">A</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,[</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>

<span class="n">F</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="n">F</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span>
<span class="n">F</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>

<span class="c1">#Solve by Gaussian elimination for U</span>
<span class="n">U</span><span class="p">,</span><span class="n">_</span><span class="p">,</span><span class="n">_</span><span class="p">,</span><span class="n">_</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">lstsq</span><span class="p">(</span><span class="n">A</span><span class="p">,</span><span class="n">h</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">F</span><span class="p">,</span><span class="n">rcond</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span>

<span class="c1"># Plot and compare to the analytic solution</span>
<span class="n">sol</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">x</span><span class="p">)</span><span class="o">/</span><span class="mi">4</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">**</span><span class="mi">2</span><span class="p">;</span>
<span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">U</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Solution&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="nb">abs</span><span class="p">((</span><span class="n">U</span><span class="o">.</span><span class="n">T</span><span class="o">-</span><span class="n">sol</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="p">))</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Error&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/dirichlet-ode_3_0.png" src="../_images/dirichlet-ode_3_0.png" />
</div>
</div>
</div>
<div class="section" id="fixed-point-method">
<h2><span class="section-number">7.2. </span>Fixed point method<a class="headerlink" href="#fixed-point-method" title="Permalink to this headline">¶</a></h2>
<p>As an alternative to using the simultaneous system of equations, the solution can often be found iteratively, by starting with a suitable initial guess for the whole field <span class="math notranslate nohighlight">\(u\)</span> and applying the formulas until (hopefully!) a fixed solution is determined.</p>
<p>To demonstrate, we will return to the 1d heat problem that was given as an exercise in the previous section</p>
<div class="amsmath math notranslate nohighlight" id="equation-88d6f28f-bb2d-41bc-938b-5c2c06809097">
<span class="eqno">(7.3)<a class="headerlink" href="#equation-88d6f28f-bb2d-41bc-938b-5c2c06809097" title="Permalink to this equation">¶</a></span>\[\begin{equation}u^{\prime\prime}(x)=\sin(2\pi x), \qquad u(0)=0, \quad u(1)=0\end{equation}\]</div>
<p>We again apply the central finite difference scheme, but this time we rearrange to the form <span class="math notranslate nohighlight">\(u=F(u)\)</span>.</p>
<div class="math notranslate nohighlight" id="equation-itsolver">
<span class="eqno">(7.4)<a class="headerlink" href="#equation-itsolver" title="Permalink to this equation">¶</a></span>\[u_k=\frac{u_{k+1}+u_{k-1}}{2}-\frac{h^2}{2}\sin(2\pi x_k)\]</div>
<p>We will repeatedly apply this equation until <span class="math notranslate nohighlight">\(u\)</span> converges to a result. A schematic illustration of this idea is provided below.</p>
<br>
<a class="reference internal image-reference" href="../_images/fixed_point.png"><img alt="secant" class="align-center" src="../_images/fixed_point.png" style="width: 791.0px; height: 233.1px;" /></a>
<br>
<p>There are a few slightly different ways that the iterative steps can be performed, which are discussed in the subsections below.</p>
<div class="section" id="jacobi-iteration">
<h3><span class="section-number">7.2.1. </span>Jacobi iteration<a class="headerlink" href="#jacobi-iteration" title="Permalink to this headline">¶</a></h3>
<p>In Jacobi iteration, each iterative step uses only values from the “old” array. We take our starting guess for <span class="math notranslate nohighlight">\(u\)</span> and apply it as a static input to the RHS of equation <a class="reference internal" href="#equation-itsolver">(7.4)</a> to obtain our new result for <span class="math notranslate nohighlight">\(u\)</span>. We repeat the method with our new result as the starting guess.</p>
<p>A visualisation of how the technique applies to <a class="reference internal" href="#equation-itsolver">(7.4)</a> is shown below.</p>
<br>
<a class="reference internal image-reference" href="../_images/jacobi.png"><img alt="secant" class="align-center" src="../_images/jacobi.png" style="width: 765.8px; height: 265.3px;" /></a>
<br>
<p>The following code applies a single Jacobi iteration for this problem. Input <span class="math notranslate nohighlight">\(k\)</span> should contain the values of <span class="math notranslate nohighlight">\(\frac{h^2}{2}\sin(2\pi x)\)</span>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">jac</span><span class="p">(</span><span class="n">u0</span><span class="p">,</span><span class="n">k</span><span class="p">):</span>
    <span class="c1"># Jacobi Iteration</span>
    <span class="n">u1</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">u0</span><span class="p">[</span><span class="mi">0</span><span class="p">],(</span><span class="n">u0</span><span class="p">[</span><span class="mi">2</span><span class="p">:]</span><span class="o">+</span><span class="n">u0</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span><span class="o">-</span><span class="n">k</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="n">u0</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>
    <span class="k">return</span> <span class="n">u1</span>
</pre></div>
</div>
</div>
</div>
<p>To find the fixed points of the Jacobi iteration, we may use a function like the one below.
Here, <code class="docutils literal notranslate"><span class="pre">testfun</span></code> will be the Jacobi iteration and <code class="docutils literal notranslate"><span class="pre">u0</span></code> will be the initial guess. The parameter <code class="docutils literal notranslate"><span class="pre">accgoal</span></code> sets a value for the desired level of convergence to achieve, and <code class="docutils literal notranslate"><span class="pre">maxit</span></code> is used to limit on the maximum number of iterations to be tried before giving up.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">iterate</span><span class="p">(</span><span class="n">testfun</span><span class="p">,</span> <span class="n">u0</span><span class="p">,</span> <span class="n">maxit</span><span class="p">,</span> <span class="n">accgoal</span><span class="p">):</span>
    <span class="c1"># Iterate until converged to within specified accuracy</span>
    <span class="k">for</span> <span class="n">counter</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">maxit</span><span class="p">)):</span>
        <span class="n">u1</span> <span class="o">=</span> <span class="n">testfun</span><span class="p">(</span><span class="n">u0</span><span class="p">)</span>
        <span class="n">err</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">u1</span><span class="o">-</span><span class="n">u0</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">err</span><span class="o">&lt;</span><span class="n">accgoal</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;converged after&#39;</span><span class="p">,</span><span class="n">counter</span><span class="p">,</span> <span class="s1">&#39;iterations&#39;</span><span class="p">)</span>
            <span class="k">break</span>
        <span class="n">u0</span> <span class="o">=</span> <span class="n">u1</span>
    <span class="k">return</span> <span class="n">u0</span>
</pre></div>
</div>
</div>
</div>
<p>Implementation of the code for 50 gridpoints is shown below, in which the initial guess is taken to be the null array <span class="math notranslate nohighlight">\(u_0 = [0,0\dots,0,0]\)</span>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Setting the grid space</span>
<span class="n">n</span> <span class="o">=</span> <span class="mi">50</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
<span class="n">h</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

<span class="c1"># Initialize grid for iterative method</span>
<span class="n">u0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
<span class="n">k</span> <span class="o">=</span> <span class="n">h</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">x</span><span class="p">)</span>

<span class="c1"># Jacobi method</span>
<span class="n">ujac</span> <span class="o">=</span> <span class="n">iterate</span><span class="p">(</span><span class="k">lambda</span> <span class="n">u</span><span class="p">:</span> <span class="p">(</span><span class="n">jac</span><span class="p">(</span><span class="n">u</span><span class="p">,</span><span class="n">k</span><span class="p">)),</span><span class="n">u0</span><span class="p">,</span><span class="mf">1e3</span><span class="p">,</span><span class="mf">1e-5</span><span class="p">)</span>

<span class="c1"># Plot and compare to the analytic solution</span>
<span class="n">sol</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">x</span><span class="p">)</span><span class="o">/</span><span class="mi">4</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">**</span><span class="mi">2</span><span class="p">;</span>
<span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">ujac</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Solution&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="nb">abs</span><span class="p">((</span><span class="n">ujac</span><span class="o">-</span><span class="n">sol</span><span class="p">)))</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Error&#39;</span><span class="p">)</span>

<span class="c1"># set the spacing between subplots</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">wspace</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>converged after 582 iterations
</pre></div>
</div>
<img alt="../_images/dirichlet-ode_9_1.png" src="../_images/dirichlet-ode_9_1.png" />
</div>
</div>
</div>
<div class="section" id="gauss-seidel">
<h3><span class="section-number">7.2.2. </span>Gauss-Seidel<a class="headerlink" href="#gauss-seidel" title="Permalink to this headline">¶</a></h3>
<p>To speed up convergence, the iterations can be applied
sequentially to each grid-point; for example by sweeping from left to right in the domain and updating each grid point in turn. This technique is known as the Gauss-Seidel
relaxation method.</p>
<p>Grid values are updated “in-place” as we sweep left to right, and the updated result at each point is fed into the subsequent calculation.</p>
<br>
<a class="reference internal image-reference" href="../_images/GS.gif"><img alt="secant" class="align-center" src="../_images/GS.gif" style="width: 832.0px; height: 133.9px;" /></a>
<br>
<p>A code that implements this algorithm is provided below.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">gsl</span><span class="p">(</span><span class="n">u0</span><span class="p">,</span><span class="n">k</span><span class="p">):</span>
    <span class="n">u1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">u0</span><span class="p">)</span>
    <span class="c1"># Gauss-Seidel iteration</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">u1</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">u1</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">u1</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">u1</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">k</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">/</span><span class="mi">2</span>
    <span class="k">return</span> <span class="n">u1</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Gauss-Seidel</span>
<span class="n">u0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># re-initialize</span>
<span class="n">ugsl</span> <span class="o">=</span> <span class="n">iterate</span><span class="p">(</span><span class="k">lambda</span> <span class="n">u</span><span class="p">:</span> <span class="n">gsl</span><span class="p">(</span><span class="n">u</span><span class="p">,</span><span class="n">k</span><span class="p">),</span><span class="n">u0</span><span class="p">,</span><span class="mf">1e3</span><span class="p">,</span><span class="mf">1e-5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>converged after 366 iterations
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="successive-relaxation">
<h3><span class="section-number">7.2.3. </span>Successive relaxation<a class="headerlink" href="#successive-relaxation" title="Permalink to this headline">¶</a></h3>
<p>A less obvious improvement in the technique, known as <em>sucessive relaxation</em>, starts with the observation that in each update step we obtain a relationship of the form</p>
<div class="math notranslate nohighlight">
\[u_{i,j}^{(new)}=u_{i,j}^{(old)}+r_{i,j}, \qquad u^{(new)}_{i,j}=F(u^{(old)})_{i,j}\]</div>
<p>where <span class="math notranslate nohighlight">\(r_{i,j}\)</span> is the residual error. The proposal allows that faster convergence might be obtained by adjusting the update step in proportion to the size of the residual, which is supposed to converge to zero:</p>
<div class="math notranslate nohighlight" id="equation-relax">
<span class="eqno">(7.5)<a class="headerlink" href="#equation-relax" title="Permalink to this equation">¶</a></span>\[u_{i,j}^{(new)}=u_{i,j}^{(old)}+\gamma r_{i,j}, \qquad r_{i,j}=F(u^{(old)})_{i,j} -u^{(old)}_{i,j}\]</div>
<p>The relaxation parameter <span class="math notranslate nohighlight">\(\gamma\)</span> is selected for faster convergence, with</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(\gamma&gt;1\)</span> over-relaxation,</p></li>
<li><p><span class="math notranslate nohighlight">\(\gamma=1\)</span> gives the ordinary GS method,</p></li>
<li><p><span class="math notranslate nohighlight">\(\gamma&lt;1\)</span> under-relaxation.</p></li>
</ul>
<p>It is difficult to predict the optimum value of <span class="math notranslate nohighlight">\(\gamma\)</span>, but values in the range <span class="math notranslate nohighlight">\((1,2)\)</span> typically work well.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">rlx</span><span class="p">(</span><span class="n">u0</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">g</span><span class="p">):</span>
    <span class="c1"># Relaxation method using relaxation parameter g</span>
    <span class="n">u1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">u0</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">u1</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">u2</span> <span class="o">=</span> <span class="p">(</span><span class="n">u1</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">u1</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">k</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">/</span><span class="mi">2</span>
        <span class="n">u1</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">u1</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">g</span><span class="o">*</span><span class="p">(</span><span class="n">u2</span><span class="o">-</span><span class="n">u1</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">u1</span>

<span class="c1"># Relaxation</span>
<span class="n">u0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># re-initialize</span>
<span class="n">sor</span><span class="o">=</span><span class="mf">1.8818</span>
<span class="n">ulrx</span> <span class="o">=</span> <span class="n">iterate</span><span class="p">(</span><span class="k">lambda</span> <span class="n">u</span><span class="p">:</span> <span class="n">rlx</span><span class="p">(</span><span class="n">u</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">sor</span><span class="p">),</span><span class="n">u0</span><span class="p">,</span><span class="mf">1e3</span><span class="p">,</span><span class="mf">1e-5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>converged after 86 iterations
</pre></div>
</div>
</div>
</div>
<div class="admonition-note admonition">
<p class="admonition-title">Note</p>
<p>In this case (and some others) the optimum parameter for Successive Over-Relaxation (SOR) can be predicted from the coefficient matrix.</p>
</div>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">M</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span><span class="mi">1</span><span class="p">)),</span><span class="n">k</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">+</span> \
    <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span><span class="mi">0</span><span class="p">)),</span>     <span class="n">k</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span> \
    <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">))),</span>  <span class="n">k</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="n">C</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">lstsq</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">M</span><span class="p">)),</span><span class="n">M</span><span class="p">,</span> <span class="n">rcond</span><span class="o">=</span><span class="kc">None</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">m</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">eig</span><span class="p">(</span><span class="n">C</span><span class="p">)[</span><span class="mi">0</span><span class="p">]))</span>
<span class="n">sor</span> <span class="o">=</span> <span class="mi">1</span><span class="o">+</span><span class="n">m</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">m</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span>
<span class="nb">print</span><span class="p">(</span><span class="n">sor</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1.8818383898322146
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="axially-symmetric-heat-flow">
<h2><span class="section-number">7.3. </span>Axially symmetric heat flow<a class="headerlink" href="#axially-symmetric-heat-flow" title="Permalink to this headline">¶</a></h2>
<p>The image below shows a cross-section of pipe insulation, which is subjected to temperatures <span class="math notranslate nohighlight">\(\phi=500K\)</span> on the inner boundary and <span class="math notranslate nohighlight">\(\phi=300K\)</span> on the outer boundary. The radial and axial directions are denoted by <span class="math notranslate nohighlight">\(r,\theta\)</span>, respectively.</p>
<br>
<a class="reference internal image-reference" href="../_images/lagging.png"><img alt="secant" class="align-center" src="../_images/lagging.png" style="width: 400.0px; height: 328.0px;" /></a>
<br>
<p>Due to axial symmetry of the problem, the governing two-dimensional heat equation <span class="math notranslate nohighlight">\(\nabla^2\phi=0\)</span> for this problem can be reduced to</p>
<div class="math notranslate nohighlight" id="equation-heateqn">
<span class="eqno">(7.6)<a class="headerlink" href="#equation-heateqn" title="Permalink to this equation">¶</a></span>\[\frac{\partial^2\phi}{\partial r^2}+\frac{1}{r}\frac{\partial \phi}{\partial r}=0.\]</div>
<div class="exercise admonition" id="finitediff/dirichlet-ode-exercise-1">
<p class="admonition-title"><span class="caption-number">Exercise 7.2 </span> </p>
<div class="section" id="exercise-content">
<p>Express equation <a class="reference internal" href="#equation-heateqn">(7.6)</a> in finite difference form, using a central difference scheme, and apply a Gauss-Seidel relaxation technique with 11 radial points to determine the solution <span class="math notranslate nohighlight">\(\phi(r)\)</span> for <span class="math notranslate nohighlight">\(r\in[0.05,0.10]\)</span> to within <span class="math notranslate nohighlight">\(10^{-4}\)</span>.</p>
<p>Graphically compare your answer to the analytic solution, which is given by</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{equation*}\phi = 200\frac{\ln(0.10)-\ln(r)}{\ln(2)} +300.\end{equation*}\]</div>
</div>
</div>
<div class="toggle docutils container">
<p><strong>Solution</strong>
The equation can be written out using the central differences formula as:</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{equation*}
\frac{\phi_{i-1}-2\phi_i+\phi_{i+1}}{h^2}+\frac{1}{r_i}\frac{\phi_{i+1}-\phi_{i-1}}{2h}=0
\end{equation*}\]</div>
<p>which rearranges to</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{equation*}
\phi_i=\frac{\left(r_i-\frac{h}{2}\right)\phi_{i-1}+\left(r_i+\frac{h}{2}\right)\phi_{i+1}}{2r_i}
\end{equation*}\]</div>
<p>This can be applied as follows</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="n">n</span><span class="o">=</span><span class="mi">11</span><span class="p">;</span>                          <span class="c1">#We are using 11 points</span>
<span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.05</span><span class="p">,</span><span class="mf">0.10</span><span class="p">,</span><span class="n">n</span><span class="p">)</span>   <span class="c1">#Construct the radial coordinate</span>
<span class="n">h</span> <span class="o">=</span><span class="n">r</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">-</span><span class="n">r</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>                     

<span class="c1">#Set up the initial grid :</span>
<span class="n">F</span> <span class="o">=</span> <span class="mi">400</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>   <span class="c1"># The temperature average is a suitable choice</span>
<span class="n">F</span><span class="p">[[</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span><span class="o">=</span><span class="p">[</span><span class="mi">500</span><span class="p">,</span><span class="mi">300</span><span class="p">]</span>  <span class="c1"># Enforce boundary conditions</span>

<span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">200</span><span class="p">):</span>         <span class="c1">#Limit to 200 iterations</span>
    <span class="n">Fcheck</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">F</span><span class="p">)</span>      <span class="c1">#To check for convergence</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>   <span class="c1">#On interior points</span>
        <span class="n">F</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="p">((</span><span class="n">r</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">-</span><span class="n">h</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">F</span><span class="p">[</span><span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">+</span><span class="n">h</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">F</span><span class="p">[</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span><span class="o">/</span><span class="mi">2</span><span class="o">/</span><span class="n">r</span><span class="p">[</span><span class="n">k</span><span class="p">];</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">Fcheck</span><span class="o">-</span><span class="n">F</span><span class="p">)</span><span class="o">&lt;</span><span class="mi">10</span><span class="o">^-</span><span class="mi">4</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;converged after&#39;</span><span class="p">,</span><span class="n">j</span><span class="p">,</span> <span class="s1">&#39;iterations&#39;</span><span class="p">)</span>
        <span class="k">break</span>
</pre></div>
</div>
<p>In this case we are able to compare to the analytic solution obtained by integrating the ODE by hand:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plot and compare to the analytic solution</span>

<span class="n">a</span><span class="o">=-</span><span class="mi">200</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span> <span class="n">b</span><span class="o">=</span><span class="mi">500</span><span class="o">-</span><span class="mi">200</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
<span class="n">Fanalytic</span><span class="o">=</span> <span class="n">a</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">r</span><span class="p">)</span><span class="o">+</span><span class="n">b</span><span class="p">;</span>

<span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">r</span><span class="p">,</span><span class="n">F</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;estimated solution&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">r</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">F</span><span class="o">-</span><span class="n">Fanalytic</span><span class="p">))</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;error&#39;</span><span class="p">)</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="mf">0.05</span><span class="p">,</span><span class="mf">0.1</span><span class="p">])</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="mf">0.05</span><span class="p">,</span><span class="mf">0.1</span><span class="p">])</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/dirichlet-ode_18_0.png" src="../_images/dirichlet-ode_18_0.png" />
</div>
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./finitediff"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        
        <div class='prev-next-bottom'>
            
    <a class='left-prev' id="prev-link" href="cauchy-ode.html" title="previous page"><span class="section-number">6. </span>Second order IVP</a>
    <a class='right-next' id="next-link" href="heat.html" title="next page"><span class="section-number">8. </span>Partial BVP</a>

        </div>
        
        </div>
    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By Natural Sciences<br/>
        
            &copy; Copyright 2021.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>
  
  <script src="../_static/js/index.1c5a1a01449ed65a7b51.js"></script>

  
  </body>
</html>